import{I as Z,d as Y,r as u,k as ie,Q as ce,a as y,e as q,o as d,b as e,n as h,t as b,F as N,j as W,i as ue,c as x,m as J,_ as de,a4 as me,R as ee,a5 as O,A as K,a6 as pe,a7 as he,a8 as ve,M as ye,q as V}from"./index-CZ-bGWNd.js";import{_ as Q}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{P as te}from"./useTheme-C-ogTrZe.js";import{g as fe,a as ge,c as be}from"./ellabotApi-BpgGKbze.js";/**
 * @license lucide-vue-next v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=a=>a.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),we=a=>a.replace(/^([A-Z])|[\s-_]+(\w)/g,(o,r,t)=>t?t.toUpperCase():r.toLowerCase()),xe=a=>{const o=we(a);return o.charAt(0).toUpperCase()+o.slice(1)},_e=(...a)=>a.filter((o,r,t)=>!!o&&o.trim()!==""&&t.indexOf(o)===r).join(" ").trim();/**
 * @license lucide-vue-next v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var G={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"};/**
 * @license lucide-vue-next v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ke=({size:a,strokeWidth:o=2,absoluteStrokeWidth:r,color:t,iconNode:w,name:M,class:v,...f},{slots:g})=>Z("svg",{...G,width:a||G.width,height:a||G.height,stroke:t||G.stroke,"stroke-width":r?Number(o)*24/Number(a):o,class:_e("lucide",...M?[`lucide-${se(xe(M))}-icon`,`lucide-${se(M)}`]:["lucide-icon"]),...f},[...w.map(m=>Z(...m)),...g.default?[g.default()]:[]]);/**
 * @license lucide-vue-next v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U=(a,o)=>(r,{slots:t})=>Z(ke,{...r,iconNode:o,name:a},t);/**
 * @license lucide-vue-next v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Me=U("activity",[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]]);/**
 * @license lucide-vue-next v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Se=U("code",[["path",{d:"m16 18 6-6-6-6",key:"eg8j8"}],["path",{d:"m8 6-6 6 6 6",key:"ppft3o"}]]);/**
 * @license lucide-vue-next v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=U("database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]);/**
 * @license lucide-vue-next v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=U("download",[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]]);/**
 * @license lucide-vue-next v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ce=U("folder",[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]]);/**
 * @license lucide-vue-next v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $e=U("play",[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]]);/**
 * @license lucide-vue-next v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=U("server",[["rect",{width:"20",height:"8",x:"2",y:"2",rx:"2",ry:"2",key:"ngkwjq"}],["rect",{width:"20",height:"8",x:"2",y:"14",rx:"2",ry:"2",key:"iecqi9"}],["line",{x1:"6",x2:"6.01",y1:"6",y2:"6",key:"16zg32"}],["line",{x1:"6",x2:"6.01",y1:"18",y2:"18",key:"nzw8ys"}]]);/**
 * @license lucide-vue-next v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Te=U("shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]);/**
 * @license lucide-vue-next v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qe=U("trending-up",[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]]),Ae={key:0,class:"service-metrics"},Be={key:0,class:"metrics-grid"},Ee={class:"metric-item"},Ie={class:"metric-bar"},Re={class:"metric-value"},ze={class:"metric-item"},je={class:"metric-bar"},Pe={class:"metric-value"},Ue={class:"metric-item"},Fe={class:"metric-value"},De={key:1,class:"metrics-grid"},He={class:"metric-label"},Le={class:"metric-bar"},Ve={class:"metric-value"},Oe={key:2,class:"metrics-grid"},Ge={class:"metric-item"},Ke={class:"metric-value"},Ze={class:"metric-item"},Ne={class:"metric-bar"},We={class:"metric-value"},Ye={class:"metric-item"},Qe={class:"metric-bar"},Xe={class:"metric-value"},Je={key:3,class:"metrics-grid"},et={class:"metric-item"},tt={class:"metric-value"},st={class:"metric-item"},at={class:"metric-value"},ot={class:"metric-item"},nt={class:"metric-value"},rt=Y({__name:"ServiceMetrics",props:{serviceId:{},showMetrics:{type:Boolean,default:!0}},setup(a){const o=a,r=u(0),t=u(0),w=u("0.0"),M=u([]),v=u(0),f=u(0),g=u(0);u(0),u(0),u(0);const m=u(0),z=u(0),F=u(0),D=u(0);let j=null;const A=(p,n)=>p>n?"#ff0000":p>n*.7?"#ffff00":"#00ff00",I=p=>{if(p===0)return"0 B";const n=1024,C=["B","KB","MB","GB"],s=Math.floor(Math.log(p)/Math.log(n));return parseFloat((p/Math.pow(n,s)).toFixed(1))+" "+C[s]},P=async()=>{try{const n=await(await fetch('http://192.168.0.99:9090/api/v1/query?query=100 - (avg(irate(node_cpu_seconds_total{mode="idle"}[5m])) * 100)')).json();n.status==="success"&&n.data.result.length>0&&(r.value=parseFloat(n.data.result[0].value[1]));const s=await(await fetch("http://192.168.0.99:9090/api/v1/query?query=(1 - (node_memory_MemAvailable_bytes / node_memory_MemTotal_bytes)) * 100")).json();s.status==="success"&&s.data.result.length>0&&(t.value=parseFloat(s.data.result[0].value[1]));const k=await(await fetch("http://192.168.0.99:9090/api/v1/query?query=node_load1")).json();k.status==="success"&&k.data.result.length>0&&(w.value=parseFloat(k.data.result[0].value[1]).toFixed(1))}catch(p){console.warn("Failed to fetch node metrics:",p)}},B=async()=>{try{const n=await(await fetch("http://192.168.0.99:9090/api/v1/query?query=zfs_pool_capacity_percent")).json();n.status==="success"&&(M.value=n.data.result.map(C=>({name:C.metric.pool.replace("-pool",""),usage:parseFloat(C.value[1])})))}catch(p){console.warn("Failed to fetch ZFS metrics:",p)}},i=async()=>{try{const n=await(await fetch('http://192.168.0.99:9090/api/v1/query?query=count(container_last_seen{name!=""})')).json();n.status==="success"&&n.data.result.length>0&&(v.value=parseInt(n.data.result[0].value[1]));const s=await(await fetch('http://192.168.0.99:9090/api/v1/query?query=sum(rate(container_cpu_usage_seconds_total{name!=""}[5m])) * 100')).json();s.status==="success"&&s.data.result.length>0&&(f.value=parseFloat(s.data.result[0].value[1]));const k=await(await fetch('http://192.168.0.99:9090/api/v1/query?query=sum(container_memory_usage_bytes{name!=""})')).json();let E=0;k.status==="success"&&k.data.result.length>0&&(E=parseFloat(k.data.result[0].value[1]));const S=await(await fetch("http://192.168.0.99:9090/api/v1/query?query=node_memory_MemTotal_bytes")).json();if(S.status==="success"&&S.data.result.length>0){const l=parseFloat(S.data.result[0].value[1]);l>0&&(g.value=E/l*100)}}catch(p){console.warn("Failed to fetch container metrics:",p)}},_=async()=>{try{const n=await(await fetch("http://192.168.0.99:9090/api/v1/targets")).json();n.status==="success"&&(z.value=n.data.activeTargets.length,m.value=n.data.activeTargets.filter(C=>C.health==="up").length),F.value=Math.floor(Math.random()*200)+400,D.value=Math.random()*1e8+5e7}catch(p){console.warn("Failed to fetch Prometheus metrics:",p)}},T=async()=>{switch(o.serviceId){case"node-exporter":await P();break;case"zfs-exporter":await B();break;case"cadvisor":await i();break;case"prometheus":await _();break}};return ie(()=>{T(),j=setInterval(T,3e4)}),ce(()=>{j&&clearInterval(j)}),(p,n)=>a.showMetrics?(d(),y("div",Ae,[a.serviceId==="node-exporter"?(d(),y("div",Be,[e("div",Ee,[n[0]||(n[0]=e("span",{class:"metric-label"},"CPU",-1)),e("div",Ie,[e("div",{class:"bar-fill",style:h({width:r.value+"%",backgroundColor:A(r.value,80)})},null,4)]),e("span",Re,b(r.value.toFixed(1))+"%",1)]),e("div",ze,[n[1]||(n[1]=e("span",{class:"metric-label"},"MEM",-1)),e("div",je,[e("div",{class:"bar-fill",style:h({width:t.value+"%",backgroundColor:A(t.value,85)})},null,4)]),e("span",Pe,b(t.value.toFixed(1))+"%",1)]),e("div",Ue,[n[2]||(n[2]=e("span",{class:"metric-label"},"LOAD",-1)),e("span",Fe,b(w.value),1)])])):a.serviceId==="zfs-exporter"?(d(),y("div",De,[(d(!0),y(N,null,W(M.value,C=>(d(),y("div",{key:C.name,class:"metric-item"},[e("span",He,b(C.name),1),e("div",Le,[e("div",{class:"bar-fill",style:h({width:C.usage+"%",backgroundColor:A(C.usage,90)})},null,4)]),e("span",Ve,b(C.usage.toFixed(0))+"%",1)]))),128))])):a.serviceId==="cadvisor"?(d(),y("div",Oe,[e("div",Ge,[n[3]||(n[3]=e("span",{class:"metric-label"},"Containers",-1)),e("span",Ke,b(v.value),1)]),e("div",Ze,[n[4]||(n[4]=e("span",{class:"metric-label"},"CPU",-1)),e("div",Ne,[e("div",{class:"bar-fill",style:h({width:f.value+"%",backgroundColor:A(f.value,70)})},null,4)]),e("span",We,b(f.value.toFixed(1))+"%",1)]),e("div",Ye,[n[5]||(n[5]=e("span",{class:"metric-label"},"MEM",-1)),e("div",Qe,[e("div",{class:"bar-fill",style:h({width:g.value+"%",backgroundColor:A(g.value,80)})},null,4)]),e("span",Xe,b(g.value.toFixed(1))+"%",1)])])):a.serviceId==="prometheus"?(d(),y("div",Je,[e("div",et,[n[6]||(n[6]=e("span",{class:"metric-label"},"Targets",-1)),e("span",tt,b(m.value)+"/"+b(z.value),1)]),e("div",st,[n[7]||(n[7]=e("span",{class:"metric-label"},"Scrapes",-1)),e("span",at,b(F.value)+"/min",1)]),e("div",ot,[n[8]||(n[8]=e("span",{class:"metric-label"},"Storage",-1)),e("span",nt,b(I(D.value)),1)])])):q("",!0)])):q("",!0)}}),lt=Q(rt,[["__scopeId","data-v-18883bb8"]]),it={key:2},ct=["href"],ut="â—",dt="â—‹",mt="â—",pt="â–²",ht="â– ",re="?",vt=Y({__name:"ServiceCard",props:{service:{},elevation:{default:"medium"},borderStyle:{default:"gradient"},glowEffect:{type:Boolean,default:!0},compactMode:{type:Boolean,default:!1}},emits:["open"],setup(a){const o=a,r=ue("fallTheme"),{theme:t}=r,w=u(!1),M={prometheus:ae,"node-exporter":ne,cadvisor:Me,"zfs-exporter":ae,"qbittorrent-exporter":oe,plex:$e,grafana:qe,qbittorrent:oe,filebrowser:Ce,proxmox:ne,"code-server":Se},v=x(()=>M[o.service.id]||Te),f=x(()=>["node-exporter","zfs-exporter","cadvisor","prometheus"].includes(o.service.id)),g=$=>{var X;const l=((X=t.value.primary)==null?void 0:X.ramp3)||$;return`hue-rotate(${Object.keys(te).includes(l)?te[l]:0}deg) saturate(0.8) brightness(0.95)`},m=x(()=>{const $=[t.value.primary.ramp1,t.value.primary.ramp2,t.value.primary.ramp3,t.value.primary.ramp4,t.value.primary.ramp5,t.value.secondary.ramp1,t.value.secondary.ramp3,t.value.accent.ramp2],S=o.service.id.length%$.length,l=$[S];switch(o.service.status){case"online":return{bg:t.value.status.success,border:l,text:t.value.text.bright,glow:l+"40"};case"offline":return{bg:t.value.status.error,border:l,text:t.value.text.bright,glow:l+"40"};case"checking":return{bg:t.value.status.warning,border:l,text:t.value.text.primary,glow:l+"40"};case"warning":return{bg:t.value.status.warning,border:l,text:t.value.text.bright,glow:l+"40"};case"error":return{bg:t.value.status.error,border:l,text:t.value.text.bright,glow:l+"40"};case"unknown":default:return{bg:t.value.neutral.ramp3,border:l,text:t.value.text.bright,glow:l+"40"}}}),z=x(()=>({background:"rgba(135, 93, 88, 0.1)",border:o.borderStyle==="gradient"?`4px solid ${m.value.border}`:`4px solid ${m.value.border}`,borderRadius:"0px",padding:o.compactMode?"var(--space-md)":"var(--space-lg)",position:"relative",overflow:"hidden",cursor:"default",transition:"all var(--transition-normal)",backdropFilter:"blur(1px)",imageRendering:"pixelated",boxShadow:w.value?`
      0 8px 32px ${t.value.effects.shadow},
      0 0 20px ${m.value.glow},
      inset 3px 3px 0px ${t.value.text.primary}40,
      inset -3px -3px 0px ${t.value.effects.shadow},
      4px 4px 0px ${m.value.border}80
    `:`
      0 4px 12px ${t.value.effects.shadow},
      inset 2px 2px 0px ${t.value.text.primary}20,
      inset -2px -2px 0px ${t.value.effects.shadow},
      2px 2px 0px ${m.value.border}60
    `,transform:w.value?"translateY(-2px)":"translateY(0)",borderColor:w.value?m.value.border:m.value.border+"60"})),F=x(()=>({position:"absolute",top:"0",left:"0",right:"0",height:"2px",background:`linear-gradient(90deg, transparent, ${m.value.border}, transparent)`,opacity:w.value?"1":"0",transition:"opacity var(--transition-normal)",filter:g(m.value.border)})),D=x(()=>({display:"flex",alignItems:"flex-start",justifyContent:"space-between",marginBottom:"var(--space-md)"})),j=x(()=>({display:"flex",alignItems:"flex-start",gap:"var(--space-sm)",flex:"1"})),A=x(()=>({width:"16px",height:"16px",color:t.value.primary.ramp4,marginTop:"2px",filter:`drop-shadow(0 0 4px ${t.value.primary.ramp4}40)`})),I=x(()=>({fontSize:"0.875rem",fontWeight:"600",color:t.value.text.bright,margin:"0",lineHeight:"1.25"})),P=x(()=>({fontSize:"0.75rem",color:t.value.text.muted,margin:"4px 0 0 0",lineHeight:"1.25",opacity:"0.8"})),B=x(()=>({width:"24px",height:"24px",borderRadius:"0px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"14px",fontWeight:"bold",background:m.value.bg,border:`2px solid ${m.value.border}`,color:m.value.text,flexShrink:"0",imageRendering:"pixelated",animation:o.service.status==="checking"?"blink 1s infinite":"none",boxShadow:o.glowEffect?`
      0 0 8px ${m.value.glow},
      inset 1px 1px 0px rgba(255,255,255,0.3),
      inset -1px -1px 0px rgba(0,0,0,0.3)
    `:`
      inset 1px 1px 0px rgba(255,255,255,0.2),
      inset -1px -1px 0px rgba(0,0,0,0.2)
    `,textShadow:o.service.status==="checking"?"none":"1px 1px 0px rgba(0,0,0,0.5)",transition:"all 0.2s ease"})),i=x(()=>{switch(o.service.status){case"online":return ut;case"offline":return dt;case"checking":return mt;case"warning":return pt;case"error":return ht;case"unknown":return re;default:return re}}),_=x(()=>({display:"flex",flexDirection:"column",gap:"var(--space-xs)",marginBottom:"var(--space-md)"})),T=x(()=>({display:"flex",alignItems:"center",justifyContent:"space-between",fontSize:"0.75rem"})),p=x(()=>({color:t.value.text.muted,opacity:"0.8"})),n=x(()=>({color:t.value.primary.ramp4,fontWeight:"500"}));x(()=>({marginBottom:"var(--space-md)",paddingBottom:"var(--space-sm)",borderBottom:`1px solid ${t.value.neutral.ramp3}30`})),x(()=>({fontSize:"0.75rem",color:t.value.text.muted,opacity:"0.6",textAlign:"center"}));const C=x(()=>({display:"flex",flexDirection:"column",gap:"var(--space-xs)",marginTop:"var(--space-md)",paddingTop:"var(--space-sm)",borderTop:`1px solid ${t.value.neutral.ramp3}30`})),s=x(()=>({fontSize:"0.7rem",color:t.value.text.muted,opacity:"0.8"})),c=x(()=>({fontSize:"0.75rem",color:t.value.primary.ramp4,fontFamily:"monospace",wordBreak:"break-all",textDecoration:"none",cursor:"pointer",transition:"all var(--transition-fast)",display:"inline-block",padding:"2px 4px",borderRadius:"2px","&:hover":{color:t.value.primary.ramp5,background:`${t.value.primary.ramp4}20`,textDecoration:"underline"}})),k=$=>{const S=Math.floor($/86400),l=Math.floor($%86400/3600),L=Math.floor($%3600/60);return S>0?`${S}d ${l}h`:l>0?`${l}h ${L}m`:`${L}m`},E=$=>{if($===0)return"0 B";const S=1024,l=["B","KB","MB","GB"],L=Math.floor(Math.log($)/Math.log(S));return parseFloat(($/Math.pow(S,L)).toFixed(1))+" "+l[L]};return($,S)=>(d(),y("div",{class:"service-card-container",style:h(z.value),onMouseenter:S[1]||(S[1]=l=>w.value=!0),onMouseleave:S[2]||(S[2]=l=>w.value=!1)},[e("div",{style:h(F.value)},null,4),e("div",{style:h(D.value)},[e("div",{style:h(j.value)},[(d(),J(de(v.value),{style:h(A.value)},null,8,["style"])),e("div",null,[e("h4",{class:"nes-text",style:h(I.value)},b(a.service.name),5),e("p",{class:"nes-text",style:h(P.value)},b(a.service.description),5)])],4),e("div",{style:h(B.value)},b(i.value),5)],4),a.service.metrics?(d(),y("div",{key:0,style:h(_.value)},[a.service.metrics.uptime?(d(),y("div",{key:0,style:h(T.value)},[e("span",{class:"nes-text",style:h(p.value)},"Uptime:",4),e("span",{class:"nes-text",style:h(n.value)},b(k(a.service.metrics.uptime)),5)],4)):q("",!0),a.service.responseTime?(d(),y("div",{key:1,style:h(T.value)},[e("span",{class:"nes-text",style:h(p.value)},"Response:",4),e("span",{class:"nes-text",style:h(n.value)},b(a.service.responseTime)+"ms",5)],4)):q("",!0),a.service.id==="qbittorrent-exporter"&&a.service.metrics.customMetrics?(d(),y("div",it,[a.service.metrics.customMetrics.activeDownloads!==void 0?(d(),y("div",{key:0,style:h(T.value)},[e("span",{style:h(p.value)},"Downloads:",4),e("span",{style:h(n.value)},b(a.service.metrics.customMetrics.activeDownloads),5)],4)):q("",!0),a.service.metrics.customMetrics.downloadSpeed?(d(),y("div",{key:1,style:h(T.value)},[e("span",{style:h(p.value)},"â¬‡ Speed:",4),e("span",{style:h(n.value)},b(E(a.service.metrics.customMetrics.downloadSpeed))+"/s",5)],4)):q("",!0)])):q("",!0)],4)):q("",!0),f.value?(d(),J(lt,{key:1,"service-id":a.service.id,"show-metrics":!0},null,8,["service-id"])):q("",!0),a.service.url?(d(),y("div",{key:2,style:h(C.value)},[e("span",{class:"nes-text",style:h(s.value)},"URL:",4),e("a",{href:a.service.url,class:"nes-text",style:h(c.value),onClick:S[0]||(S[0]=me(l=>$.$emit("open",a.service.url),["prevent"])),target:"_blank",rel:"noopener noreferrer"},b(a.service.url),13,ct)],4)):q("",!0)],36))}}),Dt=Q(vt,[["__scopeId","data-v-b4a2f946"]]),yt={key:1,class:"ellabot-window nes-container is-dark"},ft={class:"ellabot-header"},gt={class:"header-title"},bt={key:0,class:"status-dot online",title:"Online"},wt={key:1,class:"status-dot offline",title:"Offline"},xt={class:"header-actions"},_t=["title"],kt={key:0,class:"welcome-message"},Mt={key:0,class:"stats"},St={class:"message-content"},Ct={class:"message-icon"},$t=["innerHTML"],Tt={key:0,class:"message-sources"},qt={key:1,class:"message assistant loading"},At={class:"ellabot-input"},Bt=["disabled"],Et=["disabled"],It={class:"ellabot-options"},Rt=Y({__name:"EllaBotChat",setup(a){const o=u(!1),r=u(!1),t=u(!1),w=u(!1),M=u(""),v=u(!0),f=u([]),g=u(null),m=u(0),z=async()=>{try{const B=await fe();w.value=B.status==="ok";const i=await ge();m.value=Object.values(i.collections).reduce((_,T)=>_+T.count,0)}catch{w.value=!1}},F=()=>{o.value=!0,r.value=!1},D=()=>{o.value=!1},j=()=>{r.value=!r.value},A=async()=>{await ye(),g.value&&(g.value.scrollTop=g.value.scrollHeight)},I=B=>B.replace(/```(\w*)\n([\s\S]*?)```/g,"<pre><code>$2</code></pre>").replace(/`([^`]+)`/g,"<code>$1</code>").replace(/\*\*([^*]+)\*\*/g,"<strong>$1</strong>").replace(/\n/g,"<br>"),P=async()=>{const B=M.value.trim();if(!(!B||t.value)){f.value.push({role:"user",content:B}),M.value="",t.value=!0,A();try{const i=f.value.slice(-10).map(T=>({role:T.role,content:T.content})),_=await be(B,{useRag:v.value,history:i.slice(0,-1)});_.success?f.value.push({role:"assistant",content:_.response,sources:_.sources}):f.value.push({role:"assistant",content:"Sorry, I encountered an error processing your request."})}catch(i){console.error("EllaBot error:",i),f.value.push({role:"assistant",content:"âš ï¸ Could not connect to EllaBot. Please check if the service is running."})}finally{t.value=!1,A()}}};return ie(()=>{z(),setInterval(z,3e4)}),(B,i)=>(d(),y("div",{class:ee(["ellabot-container",{"is-open":o.value,"is-minimized":r.value}])},[o.value?q("",!0):(d(),y("button",{key:0,class:"ellabot-toggle nes-btn is-primary",onClick:F},[...i[2]||(i[2]=[e("span",{class:"bot-icon"},"ðŸ¤–",-1),e("span",{class:"bot-label"},"EllaBot",-1)])])),o.value?(d(),y("div",yt,[e("div",ft,[e("div",gt,[i[3]||(i[3]=e("span",{class:"bot-icon"},"ðŸ¤–",-1)),i[4]||(i[4]=e("span",null,"EllaBot",-1)),w.value?(d(),y("span",bt)):(d(),y("span",wt))]),e("div",xt,[e("button",{class:"action-btn",onClick:j,title:r.value?"Expand":"Minimize"},b(r.value?"â¬†ï¸":"â¬‡ï¸"),9,_t),e("button",{class:"action-btn",onClick:D,title:"Close"},"âœ•")])]),O(e("div",{class:"ellabot-messages",ref_key:"messagesContainer",ref:g},[f.value.length===0?(d(),y("div",kt,[i[5]||(i[5]=e("p",null,"ðŸ‘‹ Hi! I'm EllaBot, your homelab assistant.",-1)),i[6]||(i[6]=e("p",null,"I have access to your documentation and can help with:",-1)),i[7]||(i[7]=e("ul",null,[e("li",null,"ðŸ³ Docker containers & services"),e("li",null,"ðŸ“¦ Proxmox VMs & LXCs"),e("li",null,"ðŸ”§ Configuration & troubleshooting"),e("li",null,"ðŸ“š Finding docs & runbooks")],-1)),m.value>0?(d(),y("p",Mt," ðŸ“„ "+b(m.value.toLocaleString())+" documents indexed ",1)):q("",!0)])):q("",!0),(d(!0),y(N,null,W(f.value,(_,T)=>(d(),y("div",{key:T,class:ee(["message",_.role])},[e("div",St,[e("span",Ct,b(_.role==="user"?"ðŸ‘¤":"ðŸ¤–"),1),e("div",{class:"message-text",innerHTML:I(_.content)},null,8,$t)]),_.sources&&_.sources.length>0?(d(),y("div",Tt,[e("details",null,[e("summary",null,"ðŸ“š Sources ("+b(_.sources.length)+")",1),e("ul",null,[(d(!0),y(N,null,W(_.sources,(p,n)=>{var C;return d(),y("li",{key:n},b(((C=p.metadata)==null?void 0:C.source)||p.collection),1)}),128))])])])):q("",!0)],2))),128)),t.value?(d(),y("div",qt,[...i[8]||(i[8]=[e("div",{class:"message-content"},[e("span",{class:"message-icon"},"ðŸ¤–"),e("div",{class:"message-text typing-indicator"},[e("span"),e("span"),e("span")])],-1)])])):q("",!0)],512),[[K,!r.value]]),O(e("div",At,[O(e("input",{"onUpdate:modelValue":i[0]||(i[0]=_=>M.value=_),type:"text",class:"nes-input",placeholder:"Ask about your homelab...",onKeyup:pe(P,["enter"]),disabled:t.value},null,40,Bt),[[he,M.value]]),e("button",{class:"nes-btn is-primary send-btn",onClick:P,disabled:t.value||!M.value.trim()},b(t.value?"...":"âž¤"),9,Et)],512),[[K,!r.value]]),O(e("div",It,[e("label",null,[O(e("input",{type:"checkbox",class:"nes-checkbox","onUpdate:modelValue":i[1]||(i[1]=_=>v.value=_)},null,512),[[ve,v.value]]),i[9]||(i[9]=e("span",null,"Use docs context",-1))])],512),[[K,!r.value]])])):q("",!0)],2))}}),Ht=Q(Rt,[["__scopeId","data-v-ec76b1dc"]]);class zt{constructor(o){this.baseUrl="http://192.168.0.99:9090",this.cache=new Map,this.requestAbortControllers=new Map,o&&(this.baseUrl=o)}async query(o,r=!0){const t=`query:${o}`;if(r){const v=this.cache.get(t);if(v&&Date.now()-v.timestamp<3e4)return v.data}const w=this.requestAbortControllers.get(t);w&&w.abort();const M=new AbortController;this.requestAbortControllers.set(t,M);try{const v=`${this.baseUrl}/api/v1/query?query=${encodeURIComponent(o)}`,f=await fetch(v,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"},signal:M.signal});if(!f.ok)throw new Error(`Prometheus API error: ${f.status} ${f.statusText}`);const g=await f.json();return g.status==="success"&&this.cache.set(t,{data:g,timestamp:Date.now()}),g}catch(v){throw v.name==="AbortError"?new Error("Request cancelled"):(console.error("Prometheus query failed:",o,v),new Error(`Failed to fetch metrics: ${v.message}`))}finally{this.requestAbortControllers.delete(t)}}async queryRange(o,r,t,w){const M=new URLSearchParams({query:o,start:r.toString(),end:t.toString(),step:w.toString()}),v=new AbortController,f=setTimeout(()=>v.abort(),1e4);try{const g=`${this.baseUrl}/api/v1/query_range?${M}`,m=await fetch(g,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"},signal:v.signal});if(clearTimeout(f),!m.ok)throw new Error(`Prometheus range query error: ${m.status} ${m.statusText}`);return await m.json()}catch(g){throw clearTimeout(f),console.error("Prometheus range query failed:",o,g),new Error(`Failed to fetch metrics range: ${g.message}`)}}async getTargets(){const o=new AbortController,r=setTimeout(()=>o.abort(),5e3);try{const t=await fetch(`${this.baseUrl}/api/v1/targets`,{method:"GET",headers:{Accept:"application/json"},signal:o.signal});if(clearTimeout(r),!t.ok)throw new Error(`Failed to fetch targets: ${t.status}`);return await t.json()}catch(t){throw clearTimeout(r),new Error(`Failed to fetch Prometheus targets: ${t.message}`)}}async isHealthy(){try{return(await fetch(`${this.baseUrl}/-/healthy`,{method:"GET",signal:AbortSignal.timeout(3e3)})).ok}catch{return!1}}clearCache(o){o?this.cache.delete(`query:${o}`):this.cache.clear()}cancelAllRequests(){this.requestAbortControllers.forEach(o=>o.abort()),this.requestAbortControllers.clear()}}const R=new zt,H={cpuUsage:'100 - (avg(rate(node_cpu_seconds_total{mode="idle"}[5m])) * 100)',cpuCores:"count(count(node_cpu_seconds_total) by (cpu))",loadAverage1m:"node_load1",loadAverage5m:"node_load5",loadAverage15m:"node_load15",memoryTotal:"node_memory_MemTotal_bytes",memoryAvailable:"node_memory_MemAvailable_bytes",memoryUsagePercent:"100 * (1 - node_memory_MemAvailable_bytes / node_memory_MemTotal_bytes)",memoryUsageBytes:"node_memory_MemTotal_bytes - node_memory_MemAvailable_bytes",diskUsagePercent:"100 - (node_filesystem_avail_bytes / node_filesystem_size_bytes * 100)",diskTotal:'node_filesystem_size_bytes{fstype!="tmpfs",mountpoint="/"}',diskUsed:'node_filesystem_size_bytes{fstype!="tmpfs",mountpoint="/"} - node_filesystem_free_bytes{fstype!="tmpfs",mountpoint="/"}',diskAvailable:'node_filesystem_avail_bytes{fstype!="tmpfs",mountpoint="/"}',networkReceiveBytesRate:'rate(node_network_receive_bytes_total{device!="lo"}[5m])',networkTransmitBytesRate:'rate(node_network_transmit_bytes_total{device!="lo"}[5m])',networkReceiveTotal:'sum(node_network_receive_bytes_total{device!="lo"})',networkTransmitTotal:'sum(node_network_transmit_bytes_total{device!="lo"})',uptime:"node_time_seconds - node_boot_time_seconds",serviceHealth:"up",prometheusTargets:"prometheus_target_health",zfsPoolHealth:"zfs_pool_health",zfsPoolUsagePercent:"zfs_pool_used_bytes / zfs_pool_size_bytes * 100",zfsPoolAvailableBytes:"zfs_pool_available_bytes",containerCount:'count(container_last_seen{name!=""})',containerTotalCpu:'sum(rate(container_cpu_usage_seconds_total{name!=""}[5m])) * 100',containerTotalMemory:'sum(container_memory_usage_bytes{name!=""})',containerCpuUsage:'sum(rate(container_cpu_usage_seconds_total{name!=""}[5m])) by (name)',containerMemoryUsage:'sum(container_memory_usage_bytes{name!=""}) by (name)',qbittorrentActiveDownloads:"qbittorrent_active_downloads",qbittorrentDownloadSpeed:"qbittorrent_download_speed_bytes",qbittorrentUploadSpeed:"qbittorrent_upload_speed_bytes"},le={extractValue(a){var r,t;if(!a||a.length===0)return 0;const o=(t=(r=a[0])==null?void 0:r.value)==null?void 0:t[1];return o?parseFloat(o):0},extractValues(a){return a.map(o=>({label:Object.values(o.metric).join(" "),value:o.value?parseFloat(o.value[1]):0}))},formatBytes(a){if(a===0)return"0 B";const o=1024,r=["B","KB","MB","GB","TB"],t=Math.floor(Math.log(a)/Math.log(o));return parseFloat((a/Math.pow(o,t)).toFixed(2))+" "+r[t]},formatPercent(a){return`${Math.round(a*100)/100}%`},formatUptime(a){const o=Math.floor(a/86400),r=Math.floor(a%86400/3600),t=Math.floor(a%3600/60);return o>0?`${o}d ${r}h ${t}m`:r>0?`${r}h ${t}m`:`${t}m`}},Lt=()=>{const a=u([{id:"prometheus",name:"Prometheus",description:"Metrics Collection System",status:"unknown",lastChecked:null,responseTime:null,job:"prometheus",instance:"localhost:9090",url:"http://192.168.0.99:9090"},{id:"node-exporter",name:"Node Exporter",description:"System Metrics Exporter",status:"unknown",lastChecked:null,responseTime:null,job:"node-exporter",instance:"proxmox-host",url:"http://192.168.0.99:9100",healthEndpoint:"http://192.168.0.99:9100"},{id:"cadvisor",name:"cAdvisor",description:"Container Metrics",status:"unknown",lastChecked:null,responseTime:null,job:"cadvisor",instance:"container-metrics",url:"http://192.168.0.99:8082/containers/",healthEndpoint:"http://192.168.0.99:8082"},{id:"zfs-exporter",name:"ZFS Exporter",description:"Storage Pool Metrics",status:"unknown",lastChecked:null,responseTime:null,job:"zfs-exporter",instance:"zfs-pools",url:"http://192.168.0.99:9101/metrics",healthEndpoint:"http://192.168.0.99:9101"},{id:"qbittorrent",name:"qBittorrent",description:"Torrent Client Web Interface",status:"unknown",lastChecked:null,responseTime:null,job:"qbittorrent",instance:"torrent-client",url:"http://192.168.0.111:8112/",healthEndpoint:"http://192.168.0.111:8112"},{id:"plex",name:"Plex Media Server",description:"Media Streaming Platform",status:"unknown",lastChecked:null,responseTime:null,job:"plex-server",instance:"media-server",url:"http://192.168.0.99:32400",healthEndpoint:"http://192.168.0.99:32400/identity"},{id:"mc-file-manager",name:"File Manager (mc)",description:"Midnight Commander in a web terminal",status:"online",lastChecked:new Date,responseTime:0,job:"local",instance:"local",url:"/file-manager",healthEndpoint:void 0},{id:"code-server",name:"Code Server",description:"VS Code in the Browser",status:"unknown",lastChecked:null,responseTime:null,job:"code-server",instance:"code-server",url:"http://192.168.0.250:8081",healthEndpoint:"http://192.168.0.250:8081"},{id:"proxmox",name:"Proxmox VE",description:"Virtualization Management",status:"unknown",lastChecked:null,responseTime:null,job:"proxmox",instance:"hypervisor",url:"https://192.168.0.99:8006",healthEndpoint:"https://192.168.0.99:8006/api2/json/version"},{id:"homeassistant",name:"Home Assistant",description:"Smart Home Automation",status:"unknown",lastChecked:null,responseTime:null,job:"homeassistant",instance:"smart-home",url:"http://192.168.0.99:8123",healthEndpoint:"http://192.168.0.99:8123"}]),o=u({totalServices:0,onlineServices:0,offlineServices:0,healthyPercentage:0,lastUpdateTime:null}),r=u(!1),t=u(""),w=u(!0),M=u(!1);let v=null;const f=x(()=>a.value.filter(s=>s.status==="online")),g=x(()=>a.value.filter(s=>s.status==="offline")),m=x(()=>a.value.filter(s=>s.status==="checking")),z=x(()=>a.value.filter(s=>s.status==="offline"&&["prometheus","node-exporter"].includes(s.id))),F=async s=>{try{const c=`up{job="${s.job}",instance="${s.instance}"}`,k=await R.query(c);if(k.status==="success"&&k.data.result.length>0){const E=le.extractValue(k.data.result);s.status=E===1?"online":"offline",s.lastChecked=new Date,await j(s)}else s.status="unknown",s.lastChecked=new Date}catch(c){console.warn(`Prometheus check failed for ${s.name}:`,c),s.status="unknown",s.lastChecked=new Date}},D=async s=>{if(!s.healthEndpoint)return;const c=Date.now();try{const k=new AbortController,E=setTimeout(()=>k.abort(),5e3),$=await fetch(s.healthEndpoint,{method:"GET",signal:k.signal,mode:"no-cors"});clearTimeout(E),s.responseTime=Date.now()-c,s.lastChecked=new Date,s.status="online"}catch(k){s.responseTime=Date.now()-c,s.lastChecked=new Date,s.status="offline",console.warn(`HTTP health check failed for ${s.name}:`,k)}},j=async s=>{try{const c=[];switch(c.push(R.query("node_time_seconds - node_boot_time_seconds").catch(()=>null)),s.id){case"qbittorrent-exporter":c.push(R.query(H.qbittorrentActiveDownloads).catch(()=>null),R.query(H.qbittorrentDownloadSpeed).catch(()=>null),R.query(H.qbittorrentUploadSpeed).catch(()=>null));break;case"zfs-exporter":c.push(R.query(H.zfsPoolHealth).catch(()=>null),R.query(H.zfsPoolUsagePercent).catch(()=>null));break;case"cadvisor":c.push(R.query(H.containerCount).catch(()=>null),R.query(H.containerTotalCpu).catch(()=>null),R.query(H.containerTotalMemory).catch(()=>null));break}const k=await Promise.allSettled(c);s.metrics||(s.metrics={}),k.forEach((E,$)=>{var S;if(E.status==="fulfilled"&&((S=E.value)==null?void 0:S.status)==="success"){const l=le.extractValue(E.value.data.result);switch($){case 0:s.metrics.uptime=l;break;default:if(s.id==="qbittorrent-exporter")switch($){case 1:s.metrics.customMetrics={...s.metrics.customMetrics,activeDownloads:l};break;case 2:s.metrics.customMetrics={...s.metrics.customMetrics,downloadSpeed:l};break;case 3:s.metrics.customMetrics={...s.metrics.customMetrics,uploadSpeed:l};break}else if(s.id==="cadvisor")switch($){case 1:s.metrics.customMetrics={...s.metrics.customMetrics,containerCount:l};break;case 2:s.metrics.customMetrics={...s.metrics.customMetrics,cpuUsage:l};break;case 3:s.metrics.customMetrics={...s.metrics.customMetrics,memoryUsage:l};break}break}}})}catch(c){console.warn(`Failed to fetch metrics for ${s.name}:`,c)}},A=async s=>{s.status="checking",await F(s),s.status==="unknown"&&s.healthEndpoint&&await D(s)},I=async()=>{try{r.value=!0,t.value="";const s=a.value.map(c=>A(c));await Promise.allSettled(s),P()}catch(s){console.error("Failed to check services health:",s),t.value=s instanceof Error?s.message:"Unknown error"}finally{r.value=!1}},P=()=>{const s=a.value.length,c=f.value.length,k=g.value.length;o.value={totalServices:s,onlineServices:c,offlineServices:k,healthyPercentage:s>0?c/s*100:0,lastUpdateTime:new Date}},B=async s=>{const c=a.value.find(k=>k.id===s);c&&(await A(c),P())},i=async()=>{M.value=!0,await I(),M.value=!1},_=()=>{v||(I(),v=setInterval(I,6e4))},T=()=>{v&&(clearInterval(v),v=null)},p=()=>{w.value=!w.value,w.value?_():T()},n=s=>a.value.find(c=>c.id===s),C=s=>a.value.filter(c=>c.status===s);return ce(()=>{T()}),{services:V(a),serviceMetrics:V(o),isLoading:V(r),error:V(t),isAutoRefreshEnabled:V(w),isRefreshing:V(M),onlineServices:f,offlineServices:g,checkingServices:m,criticalServices:z,checkServiceHealth:A,checkAllServicesHealth:I,refreshService:B,refreshAllServices:i,startAutoRefresh:_,stopAutoRefresh:T,toggleAutoRefresh:p,getServiceById:n,getServicesByStatus:C}};export{Ht as E,Dt as S,U as c,Lt as u};
