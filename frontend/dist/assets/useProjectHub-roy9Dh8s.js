import{r as i,c as d}from"./index-jn2-hf1V.js";const N="/cmd-api";function A(l={}){return{"Content-Type":"application/json",...l}}async function v(l,c={}){const p=`${N}${l}`,s=await fetch(p,{...c,headers:A(c.headers||{})});if(!s.ok&&s.status!==201){const u=await s.json().catch(()=>({error:s.statusText}));throw new Error(u.error||`API error ${s.status}`)}return s.json()}function j(l={}){const c=l.taskCalendar||"tasks";l.eventCalendar;const p=l.goalsStorageKey||"project-hub-goals",s=i([]),u=i([]),r=i([]),y=i(!1),o=i(null);async function m(t="incomplete"){y.value=!0,o.value=null;try{const e=new URLSearchParams({status:t,calendar:c}),a=await v(`/tasks?${e}`);s.value=(a.tasks||[]).map(n=>({id:n.uid,summary:n.summary,description:n.description||"",status:(n.status||"NEEDS-ACTION").toLowerCase().replace("_","-"),priority:n.priority||0,due:n.due||void 0,percentComplete:n.percent_complete||0,categories:n.categories||[]}))}catch(e){o.value=e.message}finally{y.value=!1}}async function k(t){o.value=null;try{const e={...t};c!=="tasks"&&(e.calendar=c);const a=await v("/tasks",{method:"POST",body:JSON.stringify(e)});return await m(),a}catch(e){throw o.value=e.message,e}}async function h(t,e){o.value=null;try{const a={...e};c!=="tasks"&&(a.calendar=c);const n=await v(`/tasks/${t}`,{method:"PUT",body:JSON.stringify(a)});return await m(),n}catch(a){throw o.value=a.message,a}}async function w(t){const e=s.value.find(n=>n.id===t);if(!e)return;const a=e.status==="completed"?"NEEDS-ACTION":"COMPLETED";return h(t,{status:a})}async function S(t){o.value=null;try{const e=c!=="tasks"?`?calendar=${c}`:"";await v(`/tasks/${t}${e}`,{method:"DELETE"}),s.value=s.value.filter(a=>a.id!==t)}catch(e){o.value=e.message}}async function T(t=60){o.value=null;try{const e=await v(`/calendar-events?days=${t}`);u.value=(e.events||[]).map(a=>({id:a.id,title:a.title,startDate:a.startDate,endDate:a.endDate,allDay:a.allDay,category:a.category,description:a.description}))}catch(e){o.value=e.message}}function E(){try{const t=localStorage.getItem(p);if(t){const e=JSON.parse(t);if(Array.isArray(e)&&e.length>0){r.value=e;return}}}catch{}l.defaultGoals&&l.defaultGoals.length>0?(r.value=l.defaultGoals.map((t,e)=>({...t,id:t.id||`seed-${e}`})),f()):r.value=[]}function f(){localStorage.setItem(p,JSON.stringify(r.value))}function D(t){r.value.push(t),f()}function C(t,e){const a=r.value.findIndex(n=>n.id===t);a>=0&&(r.value[a]={...r.value[a],...e},f())}function P(t){r.value=r.value.filter(e=>e.id!==t),f()}const $=d(()=>s.value.filter(t=>t.status!=="completed")),g=d(()=>s.value.filter(t=>t.status==="completed")),O=d(()=>s.value.filter(t=>t.priority>=1&&t.priority<=3&&t.status!=="completed")),G=d(()=>{const t=new Date().toISOString();return u.value.filter(e=>e.startDate>=t).slice(0,10)}),I=d(()=>{const t=s.value.length;if(t===0)return 0;const e=g.value.length;return Math.round(e/t*100)});return{tasks:s,events:u,goals:r,isLoading:y,error:o,incompleteTasks:$,completedTasks:g,highPriorityTasks:O,upcomingEvents:G,taskProgress:I,fetchTasks:m,createTask:k,updateTask:h,toggleTaskComplete:w,deleteTask:S,fetchProjectEvents:T,loadGoals:E,addGoal:D,updateGoal:C,removeGoal:P}}export{j as u};
