import{c,r as m,p as D}from"./index-CZ-bGWNd.js";const u="homelab-calendar-data",w=()=>({events:[{id:"1",title:"Weekly Grocery Shopping",description:"Pick up groceries for the week",startDate:new Date(2025,8,28,10,0),allDay:!1,category:"household",createdAt:new Date},{id:"2",title:"Date Night",description:"Movie and dinner",startDate:new Date(2025,8,29,19,0),allDay:!1,category:"personal",createdAt:new Date}],todoLists:[{id:"1",name:"Household Tasks",shared:!0,createdAt:new Date,items:[{id:"1",text:"Fix kitchen faucet",completed:!1,category:"maintenance",priority:"high",createdAt:new Date},{id:"2",text:"Clean garage",completed:!1,category:"cleaning",priority:"medium",createdAt:new Date}]},{id:"2",name:"Tech Projects",shared:!0,createdAt:new Date,items:[{id:"3",text:"Setup backup automation",completed:!1,category:"tech",priority:"medium",createdAt:new Date},{id:"4",text:"Upgrade Plex server",completed:!0,category:"tech",priority:"low",createdAt:new Date,completedAt:new Date}]}],lastUpdated:new Date}),v=()=>{try{const s=localStorage.getItem(u);if(s){const r=JSON.parse(s);return r.events=r.events.map(d=>({...d,startDate:new Date(d.startDate),endDate:d.endDate?new Date(d.endDate):void 0,createdAt:new Date(d.createdAt),updatedAt:d.updatedAt?new Date(d.updatedAt):void 0})),r.todoLists=r.todoLists.map(d=>({...d,createdAt:new Date(d.createdAt),updatedAt:d.updatedAt?new Date(d.updatedAt):void 0,items:d.items.map(i=>({...i,createdAt:new Date(i.createdAt),completedAt:i.completedAt?new Date(i.completedAt):void 0,dueDate:i.dueDate?new Date(i.dueDate):void 0}))})),r.lastUpdated=new Date(r.lastUpdated),r}}catch(s){console.warn("Error loading calendar data from localStorage:",s)}return w()},f=s=>{try{const r=JSON.stringify(s);if(new Blob([r]).size/1024/1024>5)throw console.warn("Calendar data exceeds recommended size (>5MB)"),new Error("Storage quota exceeded. Consider archiving old events.");localStorage.setItem(u,r)}catch(r){throw r instanceof DOMException&&r.name==="QuotaExceededError"?(console.error("LocalStorage quota exceeded:",r),new Error("Storage quota exceeded. Please delete some events or todo lists.")):r instanceof Error?(console.error("Error saving calendar data:",r),r):(console.error("Unknown error saving calendar data:",r),new Error("Failed to save calendar data. Please check your browser storage settings."))}},n=m(v());D(n,s=>{try{s.lastUpdated=new Date,f(s)}catch(r){console.error("Failed to auto-save calendar data:",r)}},{deep:!0});function I(){const s=c(()=>n.value.events),r=c(()=>n.value.todoLists),d=c(()=>r.value.flatMap(t=>t.items.map(a=>({...a,listName:t.name})))),i=c(()=>{const t=new Date,a=new Date(t.getTime()+7*24*60*60*1e3);return s.value.filter(e=>e.startDate>=t&&e.startDate<=a).sort((e,o)=>e.startDate.getTime()-o.startDate.getTime()).slice(0,5)}),p=c(()=>d.value.filter(t=>!t.completed).sort((t,a)=>{const e={high:3,medium:2,low:1},o=e[a.priority]-e[t.priority];return o!==0?o:t.createdAt.getTime()-a.createdAt.getTime()}));return{events:s,todoLists:r,allTodos:d,upcomingEvents:i,incompleteTodos:p,addEvent:t=>{const a={...t,id:Date.now().toString(),createdAt:new Date};return n.value.events.push(a),a},updateEvent:(t,a)=>{const e=n.value.events.findIndex(o=>o.id===t);return e!==-1?(n.value.events[e]={...n.value.events[e],...a,updatedAt:new Date},n.value.events[e]):null},deleteEvent:t=>{const a=n.value.events.findIndex(e=>e.id===t);return a!==-1?(n.value.events.splice(a,1),!0):!1},addTodoList:(t,a=!0)=>{const e={id:Date.now().toString(),name:t,shared:a,items:[],createdAt:new Date};return n.value.todoLists.push(e),e},addTodoItem:(t,a)=>{const e=n.value.todoLists.find(o=>o.id===t);if(e){const o={...a,id:Date.now().toString(),createdAt:new Date};return e.items.push(o),e.updatedAt=new Date,o}return null},toggleTodoItem:(t,a)=>{const e=n.value.todoLists.find(o=>o.id===t);if(e){const o=e.items.find(l=>l.id===a);if(o)return o.completed=!o.completed,o.completedAt=o.completed?new Date:void 0,e.updatedAt=new Date,o}return null},deleteTodoItem:(t,a)=>{const e=n.value.todoLists.find(o=>o.id===t);if(e){const o=e.items.findIndex(l=>l.id===a);if(o!==-1)return e.items.splice(o,1),e.updatedAt=new Date,!0}return!1},deleteTodoList:t=>{const a=n.value.todoLists.findIndex(e=>e.id===t);return a!==-1?(n.value.todoLists.splice(a,1),!0):!1}}}export{I as u};
