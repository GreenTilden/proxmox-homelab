import{a as i}from"./apiClient-C3SqeptG.js";import{r as d,c as v}from"./index-Cb9bHEfA.js";function L(c={}){const o=c.taskCalendar||"tasks";c.eventCalendar;const m=c.goalsStorageKey||"project-hub-goals",r=d([]),p=d([]),l=d([]),u=d(!1),n=d(null);async function y(a="incomplete"){u.value=!0,n.value=null;try{const t=new URLSearchParams({status:a,calendar:o}),e=await i(`/tasks?${t}`);r.value=(e.tasks||[]).map(s=>({id:s.uid,summary:s.summary,description:s.description||"",status:(s.status||"NEEDS-ACTION").toLowerCase().replace("_","-"),priority:s.priority||0,due:s.due||void 0,percentComplete:s.percent_complete||0,categories:Array.isArray(s.categories)?s.categories:[]}))}catch(t){n.value=t.message}finally{u.value=!1}}async function w(a){n.value=null;try{const t={...a};o!=="tasks"&&(t.calendar=o);const e=await i("/tasks",{method:"POST",body:JSON.stringify(t)});return await y(),e}catch(t){throw n.value=t.message,t}}async function g(a,t){n.value=null;try{const e={...t};o!=="tasks"&&(e.calendar=o);const s=await i(`/tasks/${a}`,{method:"PUT",body:JSON.stringify(e)});return await y(),s}catch(e){throw n.value=e.message,e}}async function S(a){const t=r.value.find(s=>s.id===a);if(!t)return;const e=t.status==="completed"?"NEEDS-ACTION":"COMPLETED";return g(a,{status:e})}async function T(a){n.value=null;try{const t=o!=="tasks"?`?calendar=${o}`:"";await i(`/tasks/${a}${t}`,{method:"DELETE"}),r.value=r.value.filter(e=>e.id!==a)}catch(t){n.value=t.message}}async function h(a=60){n.value=null;try{const t=await i(`/calendar-events?days=${a}`);p.value=(t.events||[]).map(e=>({id:e.id,title:e.title,startDate:e.startDate,endDate:e.endDate,allDay:e.allDay,category:e.category,description:e.description}))}catch(t){n.value=t.message}}function D(){try{const a=localStorage.getItem(m);if(a){const t=JSON.parse(a);if(Array.isArray(t)&&t.length>0){l.value=t;return}}}catch{}c.defaultGoals&&c.defaultGoals.length>0?(l.value=c.defaultGoals.map((a,t)=>({...a,id:a.id||`seed-${t}`})),f()):l.value=[]}function f(){localStorage.setItem(m,JSON.stringify(l.value))}function E(a){l.value.push(a),f()}function C(a,t){const e=l.value.findIndex(s=>s.id===a);e>=0&&(l.value[e]={...l.value[e],...t},f())}function O(a){l.value=l.value.filter(t=>t.id!==a),f()}const P=v(()=>r.value.filter(a=>a.status!=="completed")),k=v(()=>r.value.filter(a=>a.status==="completed")),G=v(()=>r.value.filter(a=>a.priority>=1&&a.priority<=3&&a.status!=="completed")),N=v(()=>{const a=new Date().toISOString();return p.value.filter(t=>t.startDate>=a).slice(0,10)}),$=v(()=>{const a=r.value.length;if(a===0)return 0;const t=k.value.length;return Math.round(t/a*100)});async function b(){u.value=!0;try{await Promise.all([y(),h()])}finally{u.value=!1}}return{tasks:r,events:p,goals:l,isLoading:u,error:n,incompleteTasks:P,completedTasks:k,highPriorityTasks:G,upcomingEvents:N,taskProgress:$,init:b,fetchTasks:y,createTask:w,updateTask:g,toggleTaskComplete:S,deleteTask:T,fetchProjectEvents:h,loadGoals:D,addGoal:E,updateGoal:C,removeGoal:O}}export{L as u};
