import{M as S,r as f,c as k,q as H,z as w}from"./index-Cb9bHEfA.js";/**
 * @license lucide-vue-next v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const E=o=>o.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),V=o=>o.replace(/^([A-Z])|[\s-_]+(\w)/g,(t,s,n)=>n?n.toUpperCase():s.toLowerCase()),L=o=>{const t=V(o);return t.charAt(0).toUpperCase()+t.slice(1)},G=(...o)=>o.filter((t,s,n)=>!!t&&t.trim()!==""&&n.indexOf(t)===s).join(" ").trim();/**
 * @license lucide-vue-next v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var v={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"};/**
 * @license lucide-vue-next v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=({size:o,strokeWidth:t=2,absoluteStrokeWidth:s,color:n,iconNode:h,name:c,class:r,...u},{slots:l})=>S("svg",{...v,width:o||v.width,height:o||v.height,stroke:n||v.stroke,"stroke-width":s?Number(t)*24/Number(o):t,class:G("lucide",...c?[`lucide-${E(L(c))}-icon`,`lucide-${E(c)}`]:["lucide-icon"]),...u},[...h.map(d=>S(...d)),...l.default?[l.default()]:[]]);/**
 * @license lucide-vue-next v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const p=(o,t)=>(s,{slots:n})=>S(Z,{...s,iconNode:t,name:o},n);/**
 * @license lucide-vue-next v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O=p("activity",[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]]);/**
 * @license lucide-vue-next v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=p("database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]);/**
 * @license lucide-vue-next v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=p("download",[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]]);/**
 * @license lucide-vue-next v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=p("folder",[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]]);/**
 * @license lucide-vue-next v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W=p("play",[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]]);/**
 * @license lucide-vue-next v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=p("server",[["rect",{width:"20",height:"8",x:"2",y:"2",rx:"2",ry:"2",key:"ngkwjq"}],["rect",{width:"20",height:"8",x:"2",y:"14",rx:"2",ry:"2",key:"iecqi9"}],["line",{x1:"6",x2:"6.01",y1:"6",y2:"6",key:"16zg32"}],["line",{x1:"6",x2:"6.01",y1:"18",y2:"18",key:"nzw8ys"}]]);/**
 * @license lucide-vue-next v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=p("shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]);/**
 * @license lucide-vue-next v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=p("trending-up",[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]]);class K{constructor(t){this.baseUrl="http://192.168.0.99:9090",this.cache=new Map,this.requestAbortControllers=new Map,t&&(this.baseUrl=t)}async query(t,s=!0){const n=`query:${t}`;if(s){const r=this.cache.get(n);if(r&&Date.now()-r.timestamp<3e4)return r.data}const h=this.requestAbortControllers.get(n);h&&h.abort();const c=new AbortController;this.requestAbortControllers.set(n,c);try{const r=`${this.baseUrl}/api/v1/query?query=${encodeURIComponent(t)}`,u=await fetch(r,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"},signal:c.signal});if(!u.ok)throw new Error(`Prometheus API error: ${u.status} ${u.statusText}`);const l=await u.json();return l.status==="success"&&this.cache.set(n,{data:l,timestamp:Date.now()}),l}catch(r){throw r.name==="AbortError"?new Error("Request cancelled"):(console.error("Prometheus query failed:",t,r),new Error(`Failed to fetch metrics: ${r.message}`))}finally{this.requestAbortControllers.delete(n)}}async queryRange(t,s,n,h){const c=new URLSearchParams({query:t,start:s.toString(),end:n.toString(),step:h.toString()}),r=new AbortController,u=setTimeout(()=>r.abort(),1e4);try{const l=`${this.baseUrl}/api/v1/query_range?${c}`,d=await fetch(l,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"},signal:r.signal});if(clearTimeout(u),!d.ok)throw new Error(`Prometheus range query error: ${d.status} ${d.statusText}`);return await d.json()}catch(l){throw clearTimeout(u),console.error("Prometheus range query failed:",t,l),new Error(`Failed to fetch metrics range: ${l.message}`)}}async getTargets(){const t=new AbortController,s=setTimeout(()=>t.abort(),5e3);try{const n=await fetch(`${this.baseUrl}/api/v1/targets`,{method:"GET",headers:{Accept:"application/json"},signal:t.signal});if(clearTimeout(s),!n.ok)throw new Error(`Failed to fetch targets: ${n.status}`);return await n.json()}catch(n){throw clearTimeout(s),new Error(`Failed to fetch Prometheus targets: ${n.message}`)}}async isHealthy(){try{return(await fetch(`${this.baseUrl}/-/healthy`,{method:"GET",signal:AbortSignal.timeout(3e3)})).ok}catch{return!1}}clearCache(t){t?this.cache.delete(`query:${t}`):this.cache.clear()}cancelAllRequests(){this.requestAbortControllers.forEach(t=>t.abort()),this.requestAbortControllers.clear()}}const m=new K,_={cpuUsage:'100 - (avg(rate(node_cpu_seconds_total{mode="idle"}[5m])) * 100)',cpuCores:"count(count(node_cpu_seconds_total) by (cpu))",loadAverage1m:"node_load1",loadAverage5m:"node_load5",loadAverage15m:"node_load15",memoryTotal:"node_memory_MemTotal_bytes",memoryAvailable:"node_memory_MemAvailable_bytes",memoryUsagePercent:"100 * (1 - node_memory_MemAvailable_bytes / node_memory_MemTotal_bytes)",memoryUsageBytes:"node_memory_MemTotal_bytes - node_memory_MemAvailable_bytes",diskUsagePercent:"100 - (node_filesystem_avail_bytes / node_filesystem_size_bytes * 100)",diskTotal:'node_filesystem_size_bytes{fstype!="tmpfs",mountpoint="/"}',diskUsed:'node_filesystem_size_bytes{fstype!="tmpfs",mountpoint="/"} - node_filesystem_free_bytes{fstype!="tmpfs",mountpoint="/"}',diskAvailable:'node_filesystem_avail_bytes{fstype!="tmpfs",mountpoint="/"}',networkReceiveBytesRate:'rate(node_network_receive_bytes_total{device!="lo"}[5m])',networkTransmitBytesRate:'rate(node_network_transmit_bytes_total{device!="lo"}[5m])',networkReceiveTotal:'sum(node_network_receive_bytes_total{device!="lo"})',networkTransmitTotal:'sum(node_network_transmit_bytes_total{device!="lo"})',uptime:"node_time_seconds - node_boot_time_seconds",serviceHealth:"up",prometheusTargets:"prometheus_target_health",zfsPoolHealth:"zfs_pool_health",zfsPoolUsagePercent:"zfs_pool_used_bytes / zfs_pool_size_bytes * 100",zfsPoolAvailableBytes:"zfs_pool_available_bytes",containerCount:'count(container_last_seen{name!=""})',containerTotalCpu:'sum(rate(container_cpu_usage_seconds_total{name!=""}[5m])) * 100',containerTotalMemory:'sum(container_memory_usage_bytes{name!=""})',containerCpuUsage:'sum(rate(container_cpu_usage_seconds_total{name!=""}[5m])) by (name)',containerMemoryUsage:'sum(container_memory_usage_bytes{name!=""}) by (name)',qbittorrentActiveDownloads:"qbittorrent_active_downloads",qbittorrentDownloadSpeed:"qbittorrent_download_speed_bytes",qbittorrentUploadSpeed:"qbittorrent_upload_speed_bytes"},P={extractValue(o){var s,n;if(!o||o.length===0)return 0;const t=(n=(s=o[0])==null?void 0:s.value)==null?void 0:n[1];return t?parseFloat(t):0},extractValues(o){return o.map(t=>({label:Object.values(t.metric).join(" "),value:t.value?parseFloat(t.value[1]):0}))},formatBytes(o){if(o===0)return"0 B";const t=1024,s=["B","KB","MB","GB","TB"],n=Math.floor(Math.log(o)/Math.log(t));return parseFloat((o/Math.pow(t,n)).toFixed(2))+" "+s[n]},formatPercent(o){return`${Math.round(o*100)/100}%`},formatUptime(o){const t=Math.floor(o/86400),s=Math.floor(o%86400/3600),n=Math.floor(o%3600/60);return t>0?`${t}d ${s}h ${n}m`:s>0?`${s}h ${n}m`:`${n}m`}},oe=()=>{const o=f([{id:"prometheus",name:"Prometheus",description:"Metrics Collection System",status:"unknown",lastChecked:null,responseTime:null,job:"prometheus",instance:"localhost:9090",url:"http://192.168.0.99:9090"},{id:"node-exporter",name:"Node Exporter",description:"System Metrics Exporter",status:"unknown",lastChecked:null,responseTime:null,job:"node-exporter",instance:"proxmox-host",url:"http://192.168.0.99:9100",healthEndpoint:"http://192.168.0.99:9100"},{id:"cadvisor",name:"cAdvisor",description:"Container Metrics",status:"unknown",lastChecked:null,responseTime:null,job:"cadvisor",instance:"container-metrics",url:"http://192.168.0.99:8082/containers/",healthEndpoint:"http://192.168.0.99:8082"},{id:"zfs-exporter",name:"ZFS Exporter",description:"Storage Pool Metrics",status:"unknown",lastChecked:null,responseTime:null,job:"zfs-exporter",instance:"zfs-pools",url:"http://192.168.0.99:9101/metrics",healthEndpoint:"http://192.168.0.99:9101"},{id:"qbittorrent",name:"qBittorrent",description:"Torrent Client Web Interface",status:"unknown",lastChecked:null,responseTime:null,job:"qbittorrent",instance:"torrent-client",url:"http://192.168.0.111:8112/",healthEndpoint:"http://192.168.0.111:8112"},{id:"plex",name:"Plex Media Server",description:"Media Streaming Platform",status:"unknown",lastChecked:null,responseTime:null,job:"plex-server",instance:"media-server",url:"http://192.168.0.99:32400",healthEndpoint:"http://192.168.0.99:32400/identity"},{id:"mc-file-manager",name:"File Manager (mc)",description:"Midnight Commander in a web terminal",status:"online",lastChecked:new Date,responseTime:0,job:"local",instance:"local",url:"/file-manager",healthEndpoint:void 0},{id:"proxmox",name:"Proxmox VE",description:"Virtualization Management",status:"unknown",lastChecked:null,responseTime:null,job:"proxmox",instance:"hypervisor",url:"https://192.168.0.99:8006",healthEndpoint:"https://192.168.0.99:8006/api2/json/version"},{id:"homeassistant",name:"Home Assistant",description:"Smart Home Automation",status:"unknown",lastChecked:null,responseTime:null,job:"homeassistant",instance:"smart-home",url:"http://192.168.0.99:8123",healthEndpoint:"http://192.168.0.99:8123"},{id:"nextcloud",name:"Nextcloud",description:"Hub (Calendar & Tasks)",status:"unknown",lastChecked:null,responseTime:null,job:"nextcloud",instance:"cloud-hub",url:"https://nextcloud.darrenarney.com",healthEndpoint:"https://nextcloud.darrenarney.com/status.php"},{id:"tandoor",name:"Tandoor Recipes",description:"Recipe Management",status:"unknown",lastChecked:null,responseTime:null,job:"tandoor",instance:"recipes",url:"https://tandoor.darrenarney.com",healthEndpoint:"http://192.168.0.99:8080"},{id:"sprite-forge",name:"Sprite Forge",description:"Local AI Sprite Generation with RAG",status:"unknown",lastChecked:null,responseTime:null,job:"sprite-forge",instance:"sprite-generator",url:"http://192.168.0.127:5173",healthEndpoint:"http://192.168.0.127:3456/api/health"},{id:"comfyui",name:"ComfyUI",description:"Stable Diffusion Image Generation",status:"unknown",lastChecked:null,responseTime:null,job:"comfyui",instance:"sd-generator",url:"http://192.168.0.99:8188",healthEndpoint:"http://192.168.0.99:8188/system_stats"}]),t=f({totalServices:0,onlineServices:0,offlineServices:0,healthyPercentage:0,lastUpdateTime:null}),s=f(!1),n=f(""),h=f(!0),c=f(!1);let r=null;const u=k(()=>o.value.filter(e=>e.status==="online")),l=k(()=>o.value.filter(e=>e.status==="offline")),d=k(()=>o.value.filter(e=>e.status==="checking")),$=k(()=>o.value.filter(e=>e.status==="offline"&&["prometheus","node-exporter"].includes(e.id))),j=async e=>{try{const a=`up{job="${e.job}",instance="${e.instance}"}`,i=await m.query(a);if(i.status==="success"&&i.data.result.length>0){const y=P.extractValue(i.data.result);e.status=y===1?"online":"offline",e.lastChecked=new Date,await z(e)}else e.status="unknown",e.lastChecked=new Date}catch(a){console.warn(`Prometheus check failed for ${e.name}:`,a),e.status="unknown",e.lastChecked=new Date}},U=async e=>{if(!e.healthEndpoint)return;const a=Date.now();try{const i=new AbortController,y=setTimeout(()=>i.abort(),5e3),M=await fetch(e.healthEndpoint,{method:"GET",signal:i.signal,mode:"no-cors"});clearTimeout(y),e.responseTime=Date.now()-a,e.lastChecked=new Date,e.status="online"}catch(i){e.responseTime=Date.now()-a,e.lastChecked=new Date,e.status="offline",console.warn(`HTTP health check failed for ${e.name}:`,i)}},z=async e=>{try{const a=[];switch(a.push(m.query("node_time_seconds - node_boot_time_seconds").catch(()=>null)),e.id){case"qbittorrent-exporter":a.push(m.query(_.qbittorrentActiveDownloads).catch(()=>null),m.query(_.qbittorrentDownloadSpeed).catch(()=>null),m.query(_.qbittorrentUploadSpeed).catch(()=>null));break;case"zfs-exporter":a.push(m.query(_.zfsPoolHealth).catch(()=>null),m.query(_.zfsPoolUsagePercent).catch(()=>null));break;case"cadvisor":a.push(m.query(_.containerCount).catch(()=>null));break}const i=await Promise.allSettled(a);e.metrics||(e.metrics={}),i.forEach((y,M)=>{var q;if(y.status==="fulfilled"&&((q=y.value)==null?void 0:q.status)==="success"){const g=P.extractValue(y.value.data.result);switch(M){case 0:e.metrics.uptime=g;break;default:if(e.id==="qbittorrent-exporter")switch(M){case 1:e.metrics.customMetrics={...e.metrics.customMetrics,activeDownloads:g};break;case 2:e.metrics.customMetrics={...e.metrics.customMetrics,downloadSpeed:g};break;case 3:e.metrics.customMetrics={...e.metrics.customMetrics,uploadSpeed:g};break}break}}})}catch(a){console.warn(`Failed to fetch metrics for ${e.name}:`,a)}},C=async e=>{e.status="checking",await j(e),e.status==="unknown"&&e.healthEndpoint&&await U(e)},b=async()=>{try{s.value=!0,n.value="";const e=o.value.map(a=>C(a));await Promise.allSettled(e),x()}catch(e){console.error("Failed to check services health:",e),n.value=e instanceof Error?e.message:"Unknown error"}finally{s.value=!1}},x=()=>{const e=o.value.length,a=u.value.length,i=l.value.length;t.value={totalServices:e,onlineServices:a,offlineServices:i,healthyPercentage:e>0?a/e*100:0,lastUpdateTime:new Date}},D=async e=>{const a=o.value.find(i=>i.id===e);a&&(await C(a),x())},R=async()=>{c.value=!0,await b(),c.value=!1},A=()=>{r||(b(),r=setInterval(b,6e4))},T=()=>{r&&(clearInterval(r),r=null)},B=()=>{h.value=!h.value,h.value?A():T()},I=e=>o.value.find(a=>a.id===e),F=e=>o.value.filter(a=>a.status===e);return H(()=>{T()}),{services:w(o),serviceMetrics:w(t),isLoading:w(s),error:w(n),isAutoRefreshEnabled:w(h),isRefreshing:w(c),onlineServices:u,offlineServices:l,checkingServices:d,criticalServices:$,checkServiceHealth:C,checkAllServicesHealth:b,refreshService:D,refreshAllServices:R,startAutoRefresh:A,stopAutoRefresh:T,toggleAutoRefresh:B,getServiceById:I,getServicesByStatus:F}};export{O as A,Y as D,J as F,W as P,X as S,te as T,Q as a,ee as b,p as c,oe as u};
