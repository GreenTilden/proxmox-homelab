import{d as Z,r as o,o as ss,a as n,e as s,g as es,w as ts,h as as,j as H,s as w,t as l,f as v,F as $,k as M,a5 as x,a9 as J,aa as F,a6 as V,a7 as os,Q as ns,b as i}from"./index-Cb9bHEfA.js";import{_ as ls}from"./_plugin-vue_export-helper-DlAUqK2U.js";const C="http://192.168.0.120:5010";async function is(r,c={}){const{useRag:d=!0,history:b=[],model:g="auto"}=c,_=await fetch(`${C}/api/ellabot/chat`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:r,use_rag:d,history:b,model:g})});if(!_.ok)throw new Error(`EllaBot API error: ${_.status}`);return _.json()}async function rs(){const r=await fetch(`${C}/api/ellabot/collections`);if(!r.ok)throw new Error(`EllaBot API error: ${r.status}`);return r.json()}async function cs(){const r=await fetch(`${C}/api/ellabot/health`);if(!r.ok)throw new Error(`EllaBot API error: ${r.status}`);return r.json()}async function ds(r){const c=await fetch(`${C}/api/ellabot/digest/preview`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:r})});if(!c.ok)throw new Error(`EllaBot API error: ${c.status}`);return c.json()}async function us(r,c){const d=await fetch(`${C}/api/ellabot/digest`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:r,title:c,save:!0})});if(!d.ok)throw new Error(`EllaBot API error: ${d.status}`);return d.json()}const vs={class:"ellabot-page"},ps={class:"page-header"},fs={class:"header-left"},hs={class:"header-center"},bs={class:"header-right"},gs={class:"page-content"},_s={class:"sidebar nes-container is-dark"},ms={class:"sidebar-section"},ys={class:"stat-item"},ks={class:"stat-value nes-text is-success"},ws={class:"stat-item"},xs={class:"stat-value nes-text is-primary"},Cs={class:"sidebar-section"},Ss={class:"collection-list"},Es=["onClick"],Ts={class:"collection-name"},Ps={class:"collection-count nes-text is-disabled"},Os={class:"sidebar-section"},Bs={class:"nes-checkbox-label"},$s={class:"nes-checkbox-label"},Is={class:"sidebar-section"},As={class:"model-info"},Ms={class:"nes-text is-primary"},Vs={class:"chat-area"},js={class:"chat-container nes-container is-dark"},Ds={key:0,class:"welcome-section"},Ns={class:"message-header"},Ls={class:"message-icon"},Rs={class:"message-role"},Us=["innerHTML"],Hs={key:0,class:"message-sources"},Js={class:"nes-text is-primary"},Fs={class:"source-list"},Ks={class:"source-collection"},qs={key:0,class:"source-file"},zs={key:1,class:"message-row assistant"},Gs={class:"input-area"},Qs={class:"input-wrapper"},Ws=["disabled"],Xs=["disabled"],Ys={key:1,class:"digest-container"},Zs={class:"digest-panel nes-container is-dark"},se={class:"digest-input-section"},ee={class:"digest-title-section"},te={class:"digest-actions"},ae=["disabled"],oe=["disabled"],ne={key:0,class:"digest-preview nes-container"},le={class:"preview-header"},ie={key:0,class:"reduction-badge"},re={class:"preview-text"},ce={key:1,class:"digest-result nes-container is-rounded"},de={class:"result-file"},ue=["href"],ve={key:2,class:"digest-error nes-container is-dark"},pe={class:"nes-text is-error"},fe=Z({__name:"EllabotPage",setup(r){const c=o("chat"),d=o(!1),b=o(!1),g=o(""),_=o(!0),I=o(!0),u=o([]),S=o(null),j=o(0),A=o({}),E=o([]),D=o(""),K=()=>{try{const t=localStorage.getItem("ellabot-messages");t&&(u.value=JSON.parse(t))}catch(t){console.error("Failed to load saved messages:",t)}},q=()=>{try{const t=u.value.slice(-50);localStorage.setItem("ellabot-messages",JSON.stringify(t))}catch(t){console.error("Failed to save messages:",t)}},N=async()=>{try{const t=await cs();b.value=t.status==="ok";const e=await rs();A.value=e.collections,j.value=Object.values(e.collections).reduce((h,a)=>h+a.count,0)}catch{b.value=!1}},z=t=>{const e=E.value.indexOf(t);e>=0?E.value.splice(e,1):E.value.push(t)},L=async()=>{await ns(),S.value&&(S.value.scrollTop=S.value.scrollHeight)},G=t=>t.replace(/```(\w*)\n([\s\S]*?)```/g,'<pre class="code-block"><code>$2</code></pre>').replace(/`([^`]+)`/g,'<code class="inline-code">$1</code>').replace(/\*\*([^*]+)\*\*/g,"<strong>$1</strong>").replace(/\n/g,"<br>"),R=async()=>{const t=g.value.trim();if(!(!t||d.value)){u.value.push({role:"user",content:t}),g.value="",d.value=!0,L();try{const e=u.value.slice(-10).map(a=>({role:a.role,content:a.content})),h=await is(t,{useRag:_.value,history:e.slice(0,-1)});h.success?(D.value=h.model_used,u.value.push({role:"assistant",content:h.response,sources:h.sources})):u.value.push({role:"assistant",content:"Sorry, I encountered an error processing your request."})}catch(e){console.error("EllaBot error:",e),u.value.push({role:"assistant",content:"âš ï¸ Could not connect to EllaBot. Please check if the service is running on CT 120."})}finally{d.value=!1,q(),L()}}},Q=()=>{u.value=[],localStorage.removeItem("ellabot-messages")},p=o(""),T=o(""),m=o(!1),P=o(""),O=o(0),y=o(null),f=o(""),W=async()=>{if(p.value.trim()){m.value=!0,f.value="",y.value=null;try{const t=await ds(p.value);t.success?(P.value=t.cleaned_text,O.value=t.reduction_percent):f.value="Preview failed"}catch(t){f.value=`Error: ${t}`}finally{m.value=!1}}},X=async()=>{if(p.value.trim()){m.value=!0,f.value="",y.value=null;try{const t=await us(p.value,T.value||void 0);t.success?(y.value=t,P.value=t.cleaned_text,O.value=Math.round((1-t.cleaned_length/t.original_length)*100),p.value="",T.value=""):f.value=t.error||"Save failed"}catch(t){f.value=`Error: ${t}`}finally{m.value=!1}}};return ss(()=>{K(),N(),setInterval(N,3e4)}),(t,e)=>{const h=as("router-link");return i(),n("div",vs,[s("header",ps,[s("div",fs,[es(h,{to:"/",class:"nes-btn is-warning back-btn"},{default:ts(()=>[...e[7]||(e[7]=[H(" â† Back ",-1)])]),_:1}),e[8]||(e[8]=s("h1",{class:"nes-text is-primary page-title"},[s("span",{class:"bot-icon"},"ğŸ¤–"),H(" EllaBot AI Assistant ")],-1))]),s("div",hs,[s("button",{class:w(["nes-btn tab-btn",{"is-primary":c.value==="chat"}]),onClick:e[0]||(e[0]=a=>c.value="chat")}," ğŸ’¬ Chat ",2),s("button",{class:w(["nes-btn tab-btn",{"is-primary":c.value==="digest"}]),onClick:e[1]||(e[1]=a=>c.value="digest")}," ğŸ“‹ Digest ",2)]),s("div",bs,[s("span",{class:w(["status-indicator",{online:b.value,offline:!b.value}])},l(b.value?"â— Online":"â—‹ Offline"),3)])]),s("div",gs,[c.value==="chat"?(i(),n($,{key:0},[s("aside",_s,[s("div",ms,[e[11]||(e[11]=s("h3",{class:"section-title"},"ğŸ“Š Stats",-1)),s("div",ys,[e[9]||(e[9]=s("span",{class:"stat-label"},"Documents:",-1)),s("span",ks,l(j.value.toLocaleString()),1)]),s("div",ws,[e[10]||(e[10]=s("span",{class:"stat-label"},"Collections:",-1)),s("span",xs,l(Object.keys(A.value).length),1)])]),s("div",Cs,[e[12]||(e[12]=s("h3",{class:"section-title"},"ğŸ“š Collections",-1)),s("div",Ss,[(i(!0),n($,null,M(A.value,(a,k)=>(i(),n("div",{key:k,class:w(["collection-item",{active:E.value.includes(k)}]),onClick:B=>z(k)},[s("span",Ts,l(k),1),s("span",Ps,l(a.count),1)],10,Es))),128))])]),s("div",Os,[e[15]||(e[15]=s("h3",{class:"section-title"},"âš™ï¸ Options",-1)),s("label",Bs,[x(s("input",{type:"checkbox",class:"nes-checkbox","onUpdate:modelValue":e[2]||(e[2]=a=>_.value=a)},null,512),[[J,_.value]]),e[13]||(e[13]=s("span",null,"Use RAG Context",-1))]),s("label",$s,[x(s("input",{type:"checkbox",class:"nes-checkbox","onUpdate:modelValue":e[3]||(e[3]=a=>I.value=a)},null,512),[[J,I.value]]),e[14]||(e[14]=s("span",null,"Show Sources",-1))])]),s("div",Is,[e[16]||(e[16]=s("h3",{class:"section-title"},"ğŸ® Model",-1)),s("div",As,[s("span",Ms,l(D.value||"auto"),1)])]),s("div",{class:"sidebar-section"},[s("button",{class:"nes-btn is-error clear-btn",onClick:Q}," ğŸ—‘ï¸ Clear Chat ")])]),s("main",Vs,[s("div",js,[s("div",{class:"messages-wrapper",ref_key:"messagesContainer",ref:S},[u.value.length===0?(i(),n("div",Ds,[...e[17]||(e[17]=[F('<div class="welcome-box nes-container is-rounded" data-v-f3f97a22><h2 class="nes-text is-primary" data-v-f3f97a22>Welcome to EllaBot!</h2><p data-v-f3f97a22>I&#39;m your AI-powered homelab assistant with access to your documentation.</p><div class="capabilities" data-v-f3f97a22><div class="capability-item" data-v-f3f97a22><span class="capability-icon" data-v-f3f97a22>ğŸ³</span><span data-v-f3f97a22>Docker &amp; Containers</span></div><div class="capability-item" data-v-f3f97a22><span class="capability-icon" data-v-f3f97a22>ğŸ“¦</span><span data-v-f3f97a22>Proxmox VMs &amp; LXCs</span></div><div class="capability-item" data-v-f3f97a22><span class="capability-icon" data-v-f3f97a22>ğŸ”§</span><span data-v-f3f97a22>Configuration Help</span></div><div class="capability-item" data-v-f3f97a22><span class="capability-icon" data-v-f3f97a22>ğŸ“š</span><span data-v-f3f97a22>Documentation Search</span></div></div><p class="hint nes-text is-disabled" data-v-f3f97a22>Try asking about your services, configs, or troubleshooting!</p></div>',1)])])):v("",!0),(i(!0),n($,null,M(u.value,(a,k)=>(i(),n("div",{key:k,class:w(["message-row",a.role])},[s("div",{class:w(["message-bubble nes-container",a.role==="user"?"is-rounded":"is-dark"])},[s("div",Ns,[s("span",Ls,l(a.role==="user"?"ğŸ‘¤":"ğŸ¤–"),1),s("span",Rs,l(a.role==="user"?"You":"EllaBot"),1)]),s("div",{class:"message-content",innerHTML:G(a.content)},null,8,Us),I.value&&a.sources&&a.sources.length>0?(i(),n("div",Hs,[s("details",null,[s("summary",Js,"ğŸ“š Sources ("+l(a.sources.length)+")",1),s("ul",Fs,[(i(!0),n($,null,M(a.sources,(B,Y)=>{var U;return i(),n("li",{key:Y,class:"source-item"},[s("span",Ks,l(B.collection),1),(U=B.metadata)!=null&&U.source?(i(),n("span",qs,l(B.metadata.source),1)):v("",!0)])}),128))])])])):v("",!0)],2)],2))),128)),d.value?(i(),n("div",zs,[...e[18]||(e[18]=[F('<div class="message-bubble nes-container is-dark" data-v-f3f97a22><div class="message-header" data-v-f3f97a22><span class="message-icon" data-v-f3f97a22>ğŸ¤–</span><span class="message-role" data-v-f3f97a22>EllaBot</span></div><div class="typing-indicator" data-v-f3f97a22><span data-v-f3f97a22></span><span data-v-f3f97a22></span><span data-v-f3f97a22></span></div></div>',1)])])):v("",!0)],512),s("div",Gs,[s("div",Qs,[x(s("input",{"onUpdate:modelValue":e[4]||(e[4]=a=>g.value=a),type:"text",class:"nes-input",placeholder:"Ask EllaBot anything about your homelab...",onKeyup:os(R,["enter"]),disabled:d.value},null,40,Ws),[[V,g.value]]),s("button",{class:"nes-btn is-primary send-btn",onClick:R,disabled:d.value||!g.value.trim()},l(d.value?"...":"Send â¤"),9,Xs)])])])])],64)):v("",!0),c.value==="digest"?(i(),n("div",Ys,[s("div",Zs,[e[23]||(e[23]=s("h2",{class:"nes-text is-primary"},"ğŸ“‹ Claude Code Digest",-1)),e[24]||(e[24]=s("p",{class:"digest-description"}," Paste raw Claude Code conversation text to clean up formatting and save to Obsidian. ",-1)),s("div",se,[e[19]||(e[19]=s("label",{class:"nes-text is-primary"},"Raw Text:",-1)),x(s("textarea",{"onUpdate:modelValue":e[5]||(e[5]=a=>p.value=a),class:"nes-textarea digest-textarea",placeholder:"Paste your Claude Code conversation here...",rows:"10"},null,512),[[V,p.value]])]),s("div",ee,[e[20]||(e[20]=s("label",{class:"nes-text is-primary"},"Title (optional):",-1)),x(s("input",{"onUpdate:modelValue":e[6]||(e[6]=a=>T.value=a),type:"text",class:"nes-input",placeholder:"Auto-generated if blank"},null,512),[[V,T.value]])]),s("div",te,[s("button",{class:"nes-btn",onClick:W,disabled:!p.value.trim()||m.value}," ğŸ‘ï¸ Preview ",8,ae),s("button",{class:"nes-btn is-primary",onClick:X,disabled:!p.value.trim()||m.value},l(m.value?"...":"ğŸ’¾ Save to Vault"),9,oe)]),P.value?(i(),n("div",ne,[s("div",le,[e[21]||(e[21]=s("span",{class:"nes-text is-success"},"Cleaned Preview",-1)),O.value?(i(),n("span",ie," -"+l(O.value)+"% smaller ",1)):v("",!0)]),s("pre",re,l(P.value),1)])):v("",!0),y.value?(i(),n("div",ce,[e[22]||(e[22]=s("p",{class:"nes-text is-success"},"âœ“ Saved successfully!",-1)),s("p",de,"ğŸ“„ "+l(y.value.filename),1),s("a",{href:y.value.obsidian_uri,class:"nes-btn is-success obsidian-link",target:"_blank"}," ğŸ“– Open in Obsidian ",8,ue)])):v("",!0),f.value?(i(),n("div",ve,[s("p",pe,"âš ï¸ "+l(f.value),1)])):v("",!0)])])):v("",!0)]),e[25]||(e[25]=s("div",{class:"scanline-overlay"},null,-1))])}}}),ge=ls(fe,[["__scopeId","data-v-f3f97a22"]]);export{ge as default};
