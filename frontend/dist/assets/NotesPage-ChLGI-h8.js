import{d as y,r as h,c as w,k as C,a as d,b as t,f as D,w as S,g as x,R as _,t as v,F as H,j as N,h as B,o as u}from"./index-B984DGIg.js";import{_ as L}from"./_plugin-vue_export-helper-DlAUqK2U.js";const F={class:"notes-page"},M={class:"notes-header"},j={class:"sync-icon"},E={class:"sync-text"},O={class:"notes-content"},T={class:"notes-sidebar"},V={class:"notes-nav"},z=["onClick"],P={class:"notes-main"},R={key:0,class:"loading"},W={key:1,class:"document-view"},A={class:"doc-title"},I=["innerHTML"],J={key:2,class:"no-selection"},U=y({__name:"NotesPage",setup(q){const p=h([]),l=h(null),m=h(!0),i=h(!1),g=c=>{let e=c.replace(/^### (.*$)/gim,"<h3>$1</h3>").replace(/^## (.*$)/gim,"<h2>$1</h2>").replace(/^# (.*$)/gim,"<h1>$1</h1>").replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/```([\s\S]*?)```/g,"<pre><code>$1</code></pre>").replace(/`([^`]+)`/g,"<code>$1</code>").replace(/\[([^\]]+)\]\(([^)]+)\)/g,'<a href="$2" target="_blank">$1</a>').replace(/^\|(.+)\|$/gm,r=>{const s=r.split("|").filter(a=>a.trim());if(s.some(a=>/^[\s-:]+$/.test(a)))return"";const n="td";return"<tr>"+s.map(a=>`<${n}>${a.trim()}</${n}>`).join("")+"</tr>"}).replace(/\n\n/g,"</p><p>").replace(/^- (.*$)/gim,"<li>$1</li>");return e="<p>"+e+"</p>",e=e.replace(/<p><\/p>/g,""),e=e.replace(/(<li>.*<\/li>)/gs,"<ul>$1</ul>"),e=e.replace(/<\/ul>\s*<ul>/g,""),e=e.replace(/(<tr>.*<\/tr>)/gs,"<table>$1</table>"),e=e.replace(/<\/table>\s*<table>/g,""),e},$=w(()=>l.value?g(l.value.content):""),b=c=>{l.value=c},f=async()=>{m.value=!0;try{const c=window.location.hostname,e=await fetch(`http://${c}:5984/obsidian-vault/_all_docs?include_docs=true`,{headers:{Authorization:"Basic "+btoa("obsidian:sync-password-2024")}});if(e.ok){const r=await e.json();i.value=!0,p.value=r.rows.filter(s=>s.doc&&!s.id.startsWith("_")&&!s.id.startsWith("h:")).map(s=>{const o=s.doc,n=o.path||o._id||"Untitled",a=o.data||o.content||JSON.stringify(o,null,2);return{id:o._id,title:n.replace(/\.md$/,"").replace(/^\//,""),content:a}}),p.value.length>0&&(l.value=p.value[0])}else throw new Error("Failed to fetch")}catch(c){console.error("Error fetching from CouchDB:",c),i.value=!1;try{const e=window.location.hostname,r=["Homelab Overview","Credentials","Services","Smart Home"],s=[];for(const o of r)try{const n=await fetch(`http://${e}/vault/${o}.md`);if(n.ok){const a=await n.text();s.push({id:o,title:o,content:a})}}catch{}s.length>0&&(p.value=s,l.value=s[0],i.value=!0)}catch(e){console.error("Fallback also failed:",e)}}m.value=!1},k=()=>{f()};return C(()=>{f()}),(c,e)=>{const r=x("router-link");return u(),d("div",F,[t("header",M,[D(r,{to:"/",class:"back-link"},{default:S(()=>[...e[0]||(e[0]=[t("span",null,"â†",-1),B(" Dashboard ",-1)])]),_:1}),e[1]||(e[1]=t("h1",{class:"notes-title"},"Homelab Notes",-1)),t("div",{class:_(["sync-status",{connected:i.value}])},[t("span",j,v(i.value?"ðŸŸ¢":"ðŸ”´"),1),t("span",E,v(i.value?"CouchDB Connected":"Disconnected"),1)],2)]),t("div",O,[t("aside",T,[e[5]||(e[5]=t("h3",{class:"sidebar-title"},"Documents",-1)),t("nav",V,[(u(!0),d(H,null,N(p.value,s=>{var o;return u(),d("button",{key:s.id,onClick:n=>b(s),class:_(["nav-link",{active:((o=l.value)==null?void 0:o.id)===s.id}])},v(s.title),11,z)}),128))]),t("div",{class:"sync-info"},[e[2]||(e[2]=t("h4",null,"Obsidian Sync",-1)),e[3]||(e[3]=t("p",null,"Server: sync.darrenarney.com",-1)),e[4]||(e[4]=t("p",null,"Database: obsidian-vault",-1)),t("button",{onClick:k,class:"refresh-btn"}," ðŸ”„ Refresh ")])]),t("main",P,[m.value?(u(),d("div",R," Loading documents... ")):l.value?(u(),d("div",W,[t("h2",A,v(l.value.title),1),t("div",{class:"doc-content",innerHTML:$.value},null,8,I)])):(u(),d("div",J,[...e[6]||(e[6]=[t("p",null,"Select a document from the sidebar to view",-1)])]))])])])}}}),Q=L(U,[["__scopeId","data-v-5b2670ef"]]);export{Q as default};
