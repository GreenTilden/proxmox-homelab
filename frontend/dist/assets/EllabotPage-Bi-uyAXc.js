import{d as Y,r as l,k as Q,a as o,b as s,f as Z,w as ss,g as es,h as L,R as _,t as n,e as r,F as E,j as V,a5 as k,a8 as U,aa as F,a7 as D,a6 as ts,M as as,o as i}from"./index-Cxh-SIsm.js";import{g as ls,a as os,c as ns,d as is,b as cs}from"./ellabotApi-BpgGKbze.js";import{_ as rs}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ds={class:"ellabot-page"},us={class:"page-header"},vs={class:"header-left"},ps={class:"header-center"},fs={class:"header-right"},bs={class:"page-content"},gs={class:"sidebar nes-container is-dark"},hs={class:"sidebar-section"},_s={class:"stat-item"},ms={class:"stat-value nes-text is-success"},ys={class:"stat-item"},ks={class:"stat-value nes-text is-primary"},xs={class:"sidebar-section"},Cs={class:"collection-list"},ws=["onClick"],Ss={class:"collection-name"},Ts={class:"collection-count nes-text is-disabled"},Ms={class:"sidebar-section"},Es={class:"nes-checkbox-label"},Bs={class:"nes-checkbox-label"},Os={class:"sidebar-section"},Ps={class:"model-info"},Vs={class:"nes-text is-primary"},Ds={class:"chat-area"},Is={class:"chat-container nes-container is-dark"},$s={key:0,class:"welcome-section"},Ns={class:"message-header"},Rs={class:"message-icon"},As={class:"message-role"},Hs=["innerHTML"],Ls={key:0,class:"message-sources"},Us={class:"nes-text is-primary"},Fs={class:"source-list"},js={class:"source-collection"},Js={key:0,class:"source-file"},Ks={key:1,class:"message-row assistant"},qs={class:"input-area"},zs={class:"input-wrapper"},Gs=["disabled"],Ws=["disabled"],Xs={key:1,class:"digest-container"},Ys={class:"digest-panel nes-container is-dark"},Qs={class:"digest-input-section"},Zs={class:"digest-title-section"},se={class:"digest-actions"},ee=["disabled"],te=["disabled"],ae={key:0,class:"digest-preview nes-container"},le={class:"preview-header"},oe={key:0,class:"reduction-badge"},ne={class:"preview-text"},ie={key:1,class:"digest-result nes-container is-rounded"},ce={class:"result-file"},re=["href"],de={key:2,class:"digest-error nes-container is-dark"},ue={class:"nes-text is-error"},ve=Y({__name:"EllabotPage",setup(pe){const b=l("chat"),p=l(!1),m=l(!1),y=l(""),B=l(!0),O=l(!0),c=l([]),x=l(null),I=l(0),P=l({}),C=l([]),$=l(""),j=()=>{try{const t=localStorage.getItem("ellabot-messages");t&&(c.value=JSON.parse(t))}catch(t){console.error("Failed to load saved messages:",t)}},J=()=>{try{const t=c.value.slice(-50);localStorage.setItem("ellabot-messages",JSON.stringify(t))}catch(t){console.error("Failed to save messages:",t)}},N=async()=>{try{const t=await ls();m.value=t.status==="ok";const e=await os();P.value=e.collections,I.value=Object.values(e.collections).reduce((v,a)=>v+a.count,0)}catch{m.value=!1}},K=t=>{const e=C.value.indexOf(t);e>=0?C.value.splice(e,1):C.value.push(t)},R=async()=>{await as(),x.value&&(x.value.scrollTop=x.value.scrollHeight)},q=t=>t.replace(/```(\w*)\n([\s\S]*?)```/g,'<pre class="code-block"><code>$2</code></pre>').replace(/`([^`]+)`/g,'<code class="inline-code">$1</code>').replace(/\*\*([^*]+)\*\*/g,"<strong>$1</strong>").replace(/\n/g,"<br>"),A=async()=>{const t=y.value.trim();if(!(!t||p.value)){c.value.push({role:"user",content:t}),y.value="",p.value=!0,R();try{const e=c.value.slice(-10).map(a=>({role:a.role,content:a.content})),v=await ns(t,{useRag:B.value,history:e.slice(0,-1)});v.success?($.value=v.model_used,c.value.push({role:"assistant",content:v.response,sources:v.sources})):c.value.push({role:"assistant",content:"Sorry, I encountered an error processing your request."})}catch(e){console.error("EllaBot error:",e),c.value.push({role:"assistant",content:"âš ï¸ Could not connect to EllaBot. Please check if the service is running on CT 120."})}finally{p.value=!1,J(),R()}}},z=()=>{c.value=[],localStorage.removeItem("ellabot-messages")},d=l(""),w=l(""),f=l(!1),S=l(""),T=l(0),g=l(null),u=l(""),G=async()=>{if(d.value.trim()){f.value=!0,u.value="",g.value=null;try{const t=await is(d.value);t.success?(S.value=t.cleaned_text,T.value=t.reduction_percent):u.value="Preview failed"}catch(t){u.value=`Error: ${t}`}finally{f.value=!1}}},W=async()=>{if(d.value.trim()){f.value=!0,u.value="",g.value=null;try{const t=await cs(d.value,w.value||void 0);t.success?(g.value=t,S.value=t.cleaned_text,T.value=Math.round((1-t.cleaned_length/t.original_length)*100),d.value="",w.value=""):u.value=t.error||"Save failed"}catch(t){u.value=`Error: ${t}`}finally{f.value=!1}}};return Q(()=>{j(),N(),setInterval(N,3e4)}),(t,e)=>{const v=es("router-link");return i(),o("div",ds,[s("header",us,[s("div",vs,[Z(v,{to:"/",class:"nes-btn is-warning back-btn"},{default:ss(()=>[...e[7]||(e[7]=[L(" â† Back ",-1)])]),_:1}),e[8]||(e[8]=s("h1",{class:"nes-text is-primary page-title"},[s("span",{class:"bot-icon"},"ğŸ¤–"),L(" EllaBot AI Assistant ")],-1))]),s("div",ps,[s("button",{class:_(["nes-btn tab-btn",{"is-primary":b.value==="chat"}]),onClick:e[0]||(e[0]=a=>b.value="chat")}," ğŸ’¬ Chat ",2),s("button",{class:_(["nes-btn tab-btn",{"is-primary":b.value==="digest"}]),onClick:e[1]||(e[1]=a=>b.value="digest")}," ğŸ“‹ Digest ",2)]),s("div",fs,[s("span",{class:_(["status-indicator",{online:m.value,offline:!m.value}])},n(m.value?"â— Online":"â—‹ Offline"),3)])]),s("div",bs,[b.value==="chat"?(i(),o(E,{key:0},[s("aside",gs,[s("div",hs,[e[11]||(e[11]=s("h3",{class:"section-title"},"ğŸ“Š Stats",-1)),s("div",_s,[e[9]||(e[9]=s("span",{class:"stat-label"},"Documents:",-1)),s("span",ms,n(I.value.toLocaleString()),1)]),s("div",ys,[e[10]||(e[10]=s("span",{class:"stat-label"},"Collections:",-1)),s("span",ks,n(Object.keys(P.value).length),1)])]),s("div",xs,[e[12]||(e[12]=s("h3",{class:"section-title"},"ğŸ“š Collections",-1)),s("div",Cs,[(i(!0),o(E,null,V(P.value,(a,h)=>(i(),o("div",{key:h,class:_(["collection-item",{active:C.value.includes(h)}]),onClick:M=>K(h)},[s("span",Ss,n(h),1),s("span",Ts,n(a.count),1)],10,ws))),128))])]),s("div",Ms,[e[15]||(e[15]=s("h3",{class:"section-title"},"âš™ï¸ Options",-1)),s("label",Es,[k(s("input",{type:"checkbox",class:"nes-checkbox","onUpdate:modelValue":e[2]||(e[2]=a=>B.value=a)},null,512),[[U,B.value]]),e[13]||(e[13]=s("span",null,"Use RAG Context",-1))]),s("label",Bs,[k(s("input",{type:"checkbox",class:"nes-checkbox","onUpdate:modelValue":e[3]||(e[3]=a=>O.value=a)},null,512),[[U,O.value]]),e[14]||(e[14]=s("span",null,"Show Sources",-1))])]),s("div",Os,[e[16]||(e[16]=s("h3",{class:"section-title"},"ğŸ® Model",-1)),s("div",Ps,[s("span",Vs,n($.value||"auto"),1)])]),s("div",{class:"sidebar-section"},[s("button",{class:"nes-btn is-error clear-btn",onClick:z}," ğŸ—‘ï¸ Clear Chat ")])]),s("main",Ds,[s("div",Is,[s("div",{class:"messages-wrapper",ref_key:"messagesContainer",ref:x},[c.value.length===0?(i(),o("div",$s,[...e[17]||(e[17]=[F('<div class="welcome-box nes-container is-rounded" data-v-f3f97a22><h2 class="nes-text is-primary" data-v-f3f97a22>Welcome to EllaBot!</h2><p data-v-f3f97a22>I&#39;m your AI-powered homelab assistant with access to your documentation.</p><div class="capabilities" data-v-f3f97a22><div class="capability-item" data-v-f3f97a22><span class="capability-icon" data-v-f3f97a22>ğŸ³</span><span data-v-f3f97a22>Docker &amp; Containers</span></div><div class="capability-item" data-v-f3f97a22><span class="capability-icon" data-v-f3f97a22>ğŸ“¦</span><span data-v-f3f97a22>Proxmox VMs &amp; LXCs</span></div><div class="capability-item" data-v-f3f97a22><span class="capability-icon" data-v-f3f97a22>ğŸ”§</span><span data-v-f3f97a22>Configuration Help</span></div><div class="capability-item" data-v-f3f97a22><span class="capability-icon" data-v-f3f97a22>ğŸ“š</span><span data-v-f3f97a22>Documentation Search</span></div></div><p class="hint nes-text is-disabled" data-v-f3f97a22>Try asking about your services, configs, or troubleshooting!</p></div>',1)])])):r("",!0),(i(!0),o(E,null,V(c.value,(a,h)=>(i(),o("div",{key:h,class:_(["message-row",a.role])},[s("div",{class:_(["message-bubble nes-container",a.role==="user"?"is-rounded":"is-dark"])},[s("div",Ns,[s("span",Rs,n(a.role==="user"?"ğŸ‘¤":"ğŸ¤–"),1),s("span",As,n(a.role==="user"?"You":"EllaBot"),1)]),s("div",{class:"message-content",innerHTML:q(a.content)},null,8,Hs),O.value&&a.sources&&a.sources.length>0?(i(),o("div",Ls,[s("details",null,[s("summary",Us,"ğŸ“š Sources ("+n(a.sources.length)+")",1),s("ul",Fs,[(i(!0),o(E,null,V(a.sources,(M,X)=>{var H;return i(),o("li",{key:X,class:"source-item"},[s("span",js,n(M.collection),1),(H=M.metadata)!=null&&H.source?(i(),o("span",Js,n(M.metadata.source),1)):r("",!0)])}),128))])])])):r("",!0)],2)],2))),128)),p.value?(i(),o("div",Ks,[...e[18]||(e[18]=[F('<div class="message-bubble nes-container is-dark" data-v-f3f97a22><div class="message-header" data-v-f3f97a22><span class="message-icon" data-v-f3f97a22>ğŸ¤–</span><span class="message-role" data-v-f3f97a22>EllaBot</span></div><div class="typing-indicator" data-v-f3f97a22><span data-v-f3f97a22></span><span data-v-f3f97a22></span><span data-v-f3f97a22></span></div></div>',1)])])):r("",!0)],512),s("div",qs,[s("div",zs,[k(s("input",{"onUpdate:modelValue":e[4]||(e[4]=a=>y.value=a),type:"text",class:"nes-input",placeholder:"Ask EllaBot anything about your homelab...",onKeyup:ts(A,["enter"]),disabled:p.value},null,40,Gs),[[D,y.value]]),s("button",{class:"nes-btn is-primary send-btn",onClick:A,disabled:p.value||!y.value.trim()},n(p.value?"...":"Send â¤"),9,Ws)])])])])],64)):r("",!0),b.value==="digest"?(i(),o("div",Xs,[s("div",Ys,[e[23]||(e[23]=s("h2",{class:"nes-text is-primary"},"ğŸ“‹ Claude Code Digest",-1)),e[24]||(e[24]=s("p",{class:"digest-description"}," Paste raw Claude Code conversation text to clean up formatting and save to Obsidian. ",-1)),s("div",Qs,[e[19]||(e[19]=s("label",{class:"nes-text is-primary"},"Raw Text:",-1)),k(s("textarea",{"onUpdate:modelValue":e[5]||(e[5]=a=>d.value=a),class:"nes-textarea digest-textarea",placeholder:"Paste your Claude Code conversation here...",rows:"10"},null,512),[[D,d.value]])]),s("div",Zs,[e[20]||(e[20]=s("label",{class:"nes-text is-primary"},"Title (optional):",-1)),k(s("input",{"onUpdate:modelValue":e[6]||(e[6]=a=>w.value=a),type:"text",class:"nes-input",placeholder:"Auto-generated if blank"},null,512),[[D,w.value]])]),s("div",se,[s("button",{class:"nes-btn",onClick:G,disabled:!d.value.trim()||f.value}," ğŸ‘ï¸ Preview ",8,ee),s("button",{class:"nes-btn is-primary",onClick:W,disabled:!d.value.trim()||f.value},n(f.value?"...":"ğŸ’¾ Save to Vault"),9,te)]),S.value?(i(),o("div",ae,[s("div",le,[e[21]||(e[21]=s("span",{class:"nes-text is-success"},"Cleaned Preview",-1)),T.value?(i(),o("span",oe," -"+n(T.value)+"% smaller ",1)):r("",!0)]),s("pre",ne,n(S.value),1)])):r("",!0),g.value?(i(),o("div",ie,[e[22]||(e[22]=s("p",{class:"nes-text is-success"},"âœ“ Saved successfully!",-1)),s("p",ce,"ğŸ“„ "+n(g.value.filename),1),s("a",{href:g.value.obsidian_uri,class:"nes-btn is-success obsidian-link",target:"_blank"}," ğŸ“– Open in Obsidian ",8,re)])):r("",!0),u.value?(i(),o("div",de,[s("p",ue,"âš ï¸ "+n(u.value),1)])):r("",!0)])])):r("",!0)]),e[25]||(e[25]=s("div",{class:"scanline-overlay"},null,-1))])}}}),he=rs(ve,[["__scopeId","data-v-f3f97a22"]]);export{he as default};
