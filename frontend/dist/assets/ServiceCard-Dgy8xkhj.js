import{d as G,r as p,o as Y,q as Z,a as f,f as g,b as u,e,n as a,t as l,F as J,k as Q,i as X,c as i,l as L,m as ee,p as te}from"./index-jn2-hf1V.js";import{_ as K}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{P as O}from"./useTheme-BetD5DwV.js";import{c as se,S as H,F as ae,D as N,T as re,P as oe,a as W,A as ne,b as ie}from"./useServiceMonitoring-BXGxJVrJ.js";/**
 * @license lucide-vue-next v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=se("code",[["path",{d:"m16 18 6-6-6-6",key:"eg8j8"}],["path",{d:"m8 6-6 6 6 6",key:"ppft3o"}]]),ce={key:0,class:"service-metrics"},ue={key:0,class:"metrics-grid"},de={class:"metric-item"},ve={class:"metric-bar"},me={class:"metric-value"},pe={class:"metric-item"},fe={class:"metric-bar"},ye={class:"metric-value"},he={class:"metric-item"},ge={class:"metric-value"},xe={key:1,class:"metrics-grid"},be={class:"metric-label"},we={class:"metric-bar"},Se={class:"metric-value"},ke={key:2,class:"metrics-grid"},Me={class:"metric-item"},_e={class:"metric-value"},Ie={class:"metric-item"},$e={class:"metric-bar"},Be={class:"metric-value"},Ce={class:"metric-item"},Fe={class:"metric-bar"},Re={class:"metric-value"},De={key:3,class:"metrics-grid"},Te={class:"metric-item"},qe={class:"metric-value"},ze={class:"metric-item"},je={class:"metric-value"},Ue={class:"metric-item"},Pe={class:"metric-value"},Ae=G({__name:"ServiceMetrics",props:{serviceId:{},showMetrics:{type:Boolean,default:!0}},setup(o){const y=o,k=p(0),t=p(0),x=p("0.0"),B=p([]),C=p(0),M=p(0),_=p(0);p(0),p(0),p(0);const d=p(0),F=p(0),R=p(0),D=p(0);let $=null;const w=(n,s)=>n>s?"#ff0000":n>s*.7?"#ffff00":"#00ff00",q=n=>{if(n===0)return"0 B";const s=1024,v=["B","KB","MB","GB"],h=Math.floor(Math.log(n)/Math.log(s));return parseFloat((n/Math.pow(s,h)).toFixed(1))+" "+v[h]},z=async()=>{try{const s=await(await fetch('http://192.168.0.99:9090/api/v1/query?query=100 - (avg(irate(node_cpu_seconds_total{mode="idle"}[5m])) * 100)')).json();s.status==="success"&&s.data.result.length>0&&(k.value=parseFloat(s.data.result[0].value[1]));const h=await(await fetch("http://192.168.0.99:9090/api/v1/query?query=(1 - (node_memory_MemAvailable_bytes / node_memory_MemTotal_bytes)) * 100")).json();h.status==="success"&&h.data.result.length>0&&(t.value=parseFloat(h.data.result[0].value[1]));const b=await(await fetch("http://192.168.0.99:9090/api/v1/query?query=node_load1")).json();b.status==="success"&&b.data.result.length>0&&(x.value=parseFloat(b.data.result[0].value[1]).toFixed(1))}catch(n){console.warn("Failed to fetch node metrics:",n)}},j=async()=>{try{const s=await(await fetch("http://192.168.0.99:9090/api/v1/query?query=zfs_pool_capacity_percent")).json();s.status==="success"&&(B.value=s.data.result.map(v=>({name:v.metric.pool.replace("-pool",""),usage:parseFloat(v.value[1])})))}catch(n){console.warn("Failed to fetch ZFS metrics:",n)}},U=async()=>{try{const s=await(await fetch('http://192.168.0.99:9090/api/v1/query?query=count(container_last_seen{name!=""})')).json();s.status==="success"&&s.data.result.length>0&&(C.value=parseInt(s.data.result[0].value[1]));const h=await(await fetch('http://192.168.0.99:9090/api/v1/query?query=sum(rate(container_cpu_usage_seconds_total{name!=""}[5m])) * 100')).json();h.status==="success"&&h.data.result.length>0&&(M.value=parseFloat(h.data.result[0].value[1]));const b=await(await fetch('http://192.168.0.99:9090/api/v1/query?query=sum(container_memory_usage_bytes{name!=""})')).json();let T=0;b.status==="success"&&b.data.result.length>0&&(T=parseFloat(b.data.result[0].value[1]));const c=await(await fetch("http://192.168.0.99:9090/api/v1/query?query=node_memory_MemTotal_bytes")).json();if(c.status==="success"&&c.data.result.length>0){const r=parseFloat(c.data.result[0].value[1]);r>0&&(_.value=T/r*100)}}catch(n){console.warn("Failed to fetch container metrics:",n)}},P=async()=>{try{const s=await(await fetch("http://192.168.0.99:9090/api/v1/targets")).json();s.status==="success"&&(F.value=s.data.activeTargets.length,d.value=s.data.activeTargets.filter(v=>v.health==="up").length),R.value=Math.floor(Math.random()*200)+400,D.value=Math.random()*1e8+5e7}catch(n){console.warn("Failed to fetch Prometheus metrics:",n)}},S=async()=>{switch(y.serviceId){case"node-exporter":await z();break;case"zfs-exporter":await j();break;case"cadvisor":await U();break;case"prometheus":await P();break}};return Y(()=>{S(),$=setInterval(S,3e4)}),Z(()=>{$&&clearInterval($)}),(n,s)=>o.showMetrics?(u(),f("div",ce,[o.serviceId==="node-exporter"?(u(),f("div",ue,[e("div",de,[s[0]||(s[0]=e("span",{class:"metric-label"},"CPU",-1)),e("div",ve,[e("div",{class:"bar-fill",style:a({width:k.value+"%",backgroundColor:w(k.value,80)})},null,4)]),e("span",me,l(k.value.toFixed(1))+"%",1)]),e("div",pe,[s[1]||(s[1]=e("span",{class:"metric-label"},"MEM",-1)),e("div",fe,[e("div",{class:"bar-fill",style:a({width:t.value+"%",backgroundColor:w(t.value,85)})},null,4)]),e("span",ye,l(t.value.toFixed(1))+"%",1)]),e("div",he,[s[2]||(s[2]=e("span",{class:"metric-label"},"LOAD",-1)),e("span",ge,l(x.value),1)])])):o.serviceId==="zfs-exporter"?(u(),f("div",xe,[(u(!0),f(J,null,Q(B.value,v=>(u(),f("div",{key:v.name,class:"metric-item"},[e("span",be,l(v.name),1),e("div",we,[e("div",{class:"bar-fill",style:a({width:v.usage+"%",backgroundColor:w(v.usage,90)})},null,4)]),e("span",Se,l(v.usage.toFixed(0))+"%",1)]))),128))])):o.serviceId==="cadvisor"?(u(),f("div",ke,[e("div",Me,[s[3]||(s[3]=e("span",{class:"metric-label"},"Containers",-1)),e("span",_e,l(C.value),1)]),e("div",Ie,[s[4]||(s[4]=e("span",{class:"metric-label"},"CPU",-1)),e("div",$e,[e("div",{class:"bar-fill",style:a({width:M.value+"%",backgroundColor:w(M.value,70)})},null,4)]),e("span",Be,l(M.value.toFixed(1))+"%",1)]),e("div",Ce,[s[5]||(s[5]=e("span",{class:"metric-label"},"MEM",-1)),e("div",Fe,[e("div",{class:"bar-fill",style:a({width:_.value+"%",backgroundColor:w(_.value,80)})},null,4)]),e("span",Re,l(_.value.toFixed(1))+"%",1)])])):o.serviceId==="prometheus"?(u(),f("div",De,[e("div",Te,[s[6]||(s[6]=e("span",{class:"metric-label"},"Targets",-1)),e("span",qe,l(d.value)+"/"+l(F.value),1)]),e("div",ze,[s[7]||(s[7]=e("span",{class:"metric-label"},"Scrapes",-1)),e("span",je,l(R.value)+"/min",1)]),e("div",Ue,[s[8]||(s[8]=e("span",{class:"metric-label"},"Storage",-1)),e("span",Pe,l(q(D.value)),1)])])):g("",!0)])):g("",!0)}}),Ee=K(Ae,[["__scopeId","data-v-18883bb8"]]),Le={key:2},Oe=["href"],He="●",Ne="○",We="◐",Ve="▲",Ge="■",V="?",Ke=G({__name:"ServiceCard",props:{service:{},elevation:{default:"medium"},borderStyle:{default:"gradient"},glowEffect:{type:Boolean,default:!0},compactMode:{type:Boolean,default:!1}},emits:["open"],setup(o){const y=o,k=X("fallTheme"),{theme:t}=k,x=p(!1),B={prometheus:W,"node-exporter":H,cadvisor:ne,"zfs-exporter":W,"qbittorrent-exporter":N,plex:oe,grafana:re,qbittorrent:N,filebrowser:ae,proxmox:H,"code-server":le},C=i(()=>B[y.service.id]||ie),M=i(()=>["node-exporter","zfs-exporter","cadvisor","prometheus"].includes(y.service.id)),_=m=>{var E;const r=((E=t.value.primary)==null?void 0:E.ramp3)||m;return`hue-rotate(${Object.keys(O).includes(r)?O[r]:0}deg) saturate(0.8) brightness(0.95)`},d=i(()=>{const m=[t.value.primary.ramp1,t.value.primary.ramp2,t.value.primary.ramp3,t.value.primary.ramp4,t.value.primary.ramp5,t.value.secondary.ramp1,t.value.secondary.ramp3,t.value.accent.ramp2],c=y.service.id.length%m.length,r=m[c];switch(y.service.status){case"online":return{bg:t.value.status.success,border:r,text:t.value.text.bright,glow:r+"40"};case"offline":return{bg:t.value.status.error,border:r,text:t.value.text.bright,glow:r+"40"};case"checking":return{bg:t.value.status.warning,border:r,text:t.value.text.primary,glow:r+"40"};case"warning":return{bg:t.value.status.warning,border:r,text:t.value.text.bright,glow:r+"40"};case"error":return{bg:t.value.status.error,border:r,text:t.value.text.bright,glow:r+"40"};case"unknown":default:return{bg:t.value.neutral.ramp3,border:r,text:t.value.text.bright,glow:r+"40"}}}),F=i(()=>({background:"rgba(135, 93, 88, 0.1)",border:y.borderStyle==="gradient"?`4px solid ${d.value.border}`:`4px solid ${d.value.border}`,borderRadius:"0px",padding:y.compactMode?"var(--space-md)":"var(--space-lg)",position:"relative",overflow:"hidden",cursor:"default",transition:"all var(--transition-normal)",backdropFilter:"blur(1px)",imageRendering:"pixelated",boxShadow:x.value?`
      0 8px 32px ${t.value.effects.shadow},
      0 0 20px ${d.value.glow},
      inset 3px 3px 0px ${t.value.text.primary}40,
      inset -3px -3px 0px ${t.value.effects.shadow},
      4px 4px 0px ${d.value.border}80
    `:`
      0 4px 12px ${t.value.effects.shadow},
      inset 2px 2px 0px ${t.value.text.primary}20,
      inset -2px -2px 0px ${t.value.effects.shadow},
      2px 2px 0px ${d.value.border}60
    `,transform:x.value?"translateY(-2px)":"translateY(0)",borderColor:x.value?d.value.border:d.value.border+"60"})),R=i(()=>({position:"absolute",top:"0",left:"0",right:"0",height:"2px",background:`linear-gradient(90deg, transparent, ${d.value.border}, transparent)`,opacity:x.value?"1":"0",transition:"opacity var(--transition-normal)",filter:_(d.value.border)})),D=i(()=>({display:"flex",alignItems:"flex-start",justifyContent:"space-between",marginBottom:"var(--space-md)"})),$=i(()=>({display:"flex",alignItems:"flex-start",gap:"var(--space-sm)",flex:"1"})),w=i(()=>({width:"16px",height:"16px",color:t.value.primary.ramp4,marginTop:"2px",filter:`drop-shadow(0 0 4px ${t.value.primary.ramp4}40)`})),q=i(()=>({fontSize:"0.875rem",fontWeight:"600",color:t.value.text.bright,margin:"0",lineHeight:"1.25"})),z=i(()=>({fontSize:"0.75rem",color:t.value.text.muted,margin:"4px 0 0 0",lineHeight:"1.25",opacity:"0.8"})),j=i(()=>({width:"24px",height:"24px",borderRadius:"0px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"14px",fontWeight:"bold",background:d.value.bg,border:`2px solid ${d.value.border}`,color:d.value.text,flexShrink:"0",imageRendering:"pixelated",animation:y.service.status==="checking"?"blink 1s infinite":"none",boxShadow:y.glowEffect?`
      0 0 8px ${d.value.glow},
      inset 1px 1px 0px rgba(255,255,255,0.3),
      inset -1px -1px 0px rgba(0,0,0,0.3)
    `:`
      inset 1px 1px 0px rgba(255,255,255,0.2),
      inset -1px -1px 0px rgba(0,0,0,0.2)
    `,textShadow:y.service.status==="checking"?"none":"1px 1px 0px rgba(0,0,0,0.5)",transition:"all 0.2s ease"})),U=i(()=>{switch(y.service.status){case"online":return He;case"offline":return Ne;case"checking":return We;case"warning":return Ve;case"error":return Ge;case"unknown":return V;default:return V}}),P=i(()=>({display:"flex",flexDirection:"column",gap:"var(--space-xs)",marginBottom:"var(--space-md)"})),S=i(()=>({display:"flex",alignItems:"center",justifyContent:"space-between",fontSize:"0.75rem"})),n=i(()=>({color:t.value.text.muted,opacity:"0.8"})),s=i(()=>({color:t.value.primary.ramp4,fontWeight:"500"}));i(()=>({marginBottom:"var(--space-md)",paddingBottom:"var(--space-sm)",borderBottom:`1px solid ${t.value.neutral.ramp3}30`})),i(()=>({fontSize:"0.75rem",color:t.value.text.muted,opacity:"0.6",textAlign:"center"}));const v=i(()=>({display:"flex",flexDirection:"column",gap:"var(--space-xs)",marginTop:"var(--space-md)",paddingTop:"var(--space-sm)",borderTop:`1px solid ${t.value.neutral.ramp3}30`})),h=i(()=>({fontSize:"0.7rem",color:t.value.text.muted,opacity:"0.8"})),A=i(()=>({fontSize:"0.75rem",color:t.value.primary.ramp4,fontFamily:"monospace",wordBreak:"break-all",textDecoration:"none",cursor:"pointer",transition:"all var(--transition-fast)",display:"inline-block",padding:"2px 4px",borderRadius:"2px","&:hover":{color:t.value.primary.ramp5,background:`${t.value.primary.ramp4}20`,textDecoration:"underline"}})),b=m=>{const c=Math.floor(m/86400),r=Math.floor(m%86400/3600),I=Math.floor(m%3600/60);return c>0?`${c}d ${r}h`:r>0?`${r}h ${I}m`:`${I}m`},T=m=>{if(m===0)return"0 B";const c=1024,r=["B","KB","MB","GB"],I=Math.floor(Math.log(m)/Math.log(c));return parseFloat((m/Math.pow(c,I)).toFixed(1))+" "+r[I]};return(m,c)=>(u(),f("div",{class:"service-card-container",style:a(F.value),onMouseenter:c[1]||(c[1]=r=>x.value=!0),onMouseleave:c[2]||(c[2]=r=>x.value=!1)},[e("div",{style:a(R.value)},null,4),e("div",{style:a(D.value)},[e("div",{style:a($.value)},[(u(),L(ee(C.value),{style:a(w.value)},null,8,["style"])),e("div",null,[e("h4",{class:"nes-text",style:a(q.value)},l(o.service.name),5),e("p",{class:"nes-text",style:a(z.value)},l(o.service.description),5)])],4),e("div",{style:a(j.value)},l(U.value),5)],4),o.service.metrics?(u(),f("div",{key:0,style:a(P.value)},[o.service.metrics.uptime?(u(),f("div",{key:0,style:a(S.value)},[e("span",{class:"nes-text",style:a(n.value)},"Uptime:",4),e("span",{class:"nes-text",style:a(s.value)},l(b(o.service.metrics.uptime)),5)],4)):g("",!0),o.service.responseTime?(u(),f("div",{key:1,style:a(S.value)},[e("span",{class:"nes-text",style:a(n.value)},"Response:",4),e("span",{class:"nes-text",style:a(s.value)},l(o.service.responseTime)+"ms",5)],4)):g("",!0),o.service.id==="qbittorrent-exporter"&&o.service.metrics.customMetrics?(u(),f("div",Le,[o.service.metrics.customMetrics.activeDownloads!==void 0?(u(),f("div",{key:0,style:a(S.value)},[e("span",{style:a(n.value)},"Downloads:",4),e("span",{style:a(s.value)},l(o.service.metrics.customMetrics.activeDownloads),5)],4)):g("",!0),o.service.metrics.customMetrics.downloadSpeed?(u(),f("div",{key:1,style:a(S.value)},[e("span",{style:a(n.value)},"⬇ Speed:",4),e("span",{style:a(s.value)},l(T(o.service.metrics.customMetrics.downloadSpeed))+"/s",5)],4)):g("",!0)])):g("",!0)],4)):g("",!0),M.value?(u(),L(Ee,{key:1,"service-id":o.service.id,"show-metrics":!0},null,8,["service-id"])):g("",!0),o.service.url?(u(),f("div",{key:2,style:a(v.value)},[e("span",{class:"nes-text",style:a(h.value)},"URL:",4),e("a",{href:o.service.url,class:"nes-text",style:a(A.value),onClick:c[0]||(c[0]=te(r=>m.$emit("open",o.service.url),["prevent"])),target:"_blank",rel:"noopener noreferrer"},l(o.service.url),13,Oe)],4)):g("",!0)],36))}}),Xe=K(Ke,[["__scopeId","data-v-b4a2f946"]]);export{Xe as S};
